<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FastAPI Real-Time Chat Application - Complete Guide</title>

	<link rel="stylesheet" href="/guides/static/css/style.css">

  </head>

  <body>
    <div class="container">
      <div class="header">
        <h1 class="tutorial-title">FastAPI Real-Time Chat Application - Complete Guide</h1>
        <p class="tutorial-description">Welcome to this comprehensive tutorial where we'll build a modern real-time chat application from scratch. We'll be using FastAPI for our backend, WebSockets for real-time communication, SQLAlchemy for database management, and create a beautiful dark-themed UI with glass morphism effects. This is a complete, production-ready chat application that you can deploy and use immediately.</p>
      </div>

      <!-- Tab Navigation -->
      <div class="tab-container">
        <div class="tab-buttons">
          <button class="tab-button active" data-tab="tutorial">Tutorial</button>
          <button class="tab-button" data-tab="flow">App Flow</button>
        </div>

        <!-- Tutorial Tab Content -->
        <div id="tutorial-tab" class="tab-content active">
          <div class="content">
            
            <div class="phase-section">
              <div class="phase-header">
                <div class="phase-number">1</div>
                <h2 class="phase-title">Project Setup & Configuration</h2>
              </div>

               
              <div class="step-item" data-step-id="1-1">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="1-1">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">1.1</div>
                    <div class="step-title-section">
                      <div class="step-title">Project Structure Setup</div>
                      
                      <div class="step-file">üìÅ setup.py</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Before we start building our chat application, let's set up the project structure and generate the necessary files. This setup script will create all the directories and files we need, generate a secure secret key for our application, and create a basic .env file with the required configuration variables. This ensures we have a clean, organized project structure from the beginning and eliminates the need to manually create each file and directory.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="1-1">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="1-1">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-python"
                  ><code class="language-python">import secrets
import os

# --- Secret Key Generation ---

def generate_secret_key():
    &#34;&#34;&#34;Generate a secure 32-byte hex token for SECRET_KEY.&#34;&#34;&#34;
    return secrets.token_hex(32)


# --- Project Structure Creation ---
dirs = [
    &#34;app&#34;,
    &#34;app/utils&#34;,
    &#34;static&#34;,
    &#34;static/css&#34;,
    &#34;static/js&#34;,
    &#34;templates&#34;
]

files = [
    &#34;main.py&#34;,
    &#34;requirements.txt&#34;,
    &#34;app/__init__.py&#34;,
    &#34;app/utils/__init__.py&#34;,
    &#34;app/utils/config.py&#34;,
    &#34;app/utils/websocket_manager.py&#34;,
    &#34;app/schemas.py&#34;,
    &#34;app/auth.py&#34;,
    &#34;app/database.py&#34;,
    &#34;app/routes.py&#34;,
    &#34;static/css/base.css&#34;,
    &#34;static/css/app.css&#34;,
    &#34;static/js/common.js&#34;,
    &#34;static/js/login.js&#34;,
    &#34;static/js/register.js&#34;,
    &#34;static/js/chat.js&#34;,
    &#34;templates/login.html&#34;,
    &#34;templates/register.html&#34;,
    &#34;templates/chat.html&#34;,
]


def touch(path):
    if not os.path.exists(path):
        with open(path, &#34;w&#34;, encoding=&#34;utf-8&#34;) as f:
            pass

# --- .env File Generation ---

def write_env_file(secret_key):
    env_content = f&#34;&#34;&#34;PROJECT_NAME=FastAPI Chat App
VERSION=
DESCRIPTION=
API_V1_STR=
SECRET_KEY={secret_key}
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=
ALLOWED_HOSTS=
DATABASE_URL=
&#34;&#34;&#34;
    with open(&#34;.env&#34;, &#34;w&#34;, encoding=&#34;utf-8&#34;) as f:
        f.write(env_content)


def write_requirements_file():
    &#34;&#34;&#34;Write the minimal requirements.txt with only used packages.&#34;&#34;&#34;
    requirements_content = &#34;&#34;&#34;fastapi==0.104.1
uvicorn[standard]==0.24.0
sqlalchemy==2.0.23
python-multipart==0.0.6
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-dotenv==1.0.0
jinja2==3.1.2
websockets==12.0
&#34;&#34;&#34;
    with open(&#34;requirements.txt&#34;, &#34;w&#34;, encoding=&#34;utf-8&#34;) as f:
        f.write(requirements_content)


if __name__ == &#34;__main__&#34;:
    # Create directories and files
    for d in dirs:
        os.makedirs(d, exist_ok=True)
    for fpath in files:
        touch(fpath)
    print(&#34;Project structure created.&#34;)

    # Generate and write .env
    secret_key = generate_secret_key()
    write_env_file(secret_key)
    print(&#34;.env file generated with a secure SECRET_KEY.&#34;)

    # Write requirements.txt
    write_requirements_file()
    print(&#34;requirements.txt generated with minimal dependencies.&#34;)</code></pre>
                </div>
                
              </div>
               
              <div class="step-item" data-step-id="1-2">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="1-2">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">1.2</div>
                    <div class="step-title-section">
                      <div class="step-title">Dependencies Configuration</div>
                      
                      <div class="step-file">üìÅ requirements.txt</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Now let's set up our project dependencies. Since our setup script has already created a basic requirements.txt file, we'll enhance it with all the packages we need for our chat application. This includes FastAPI for our web framework, uvicorn for the ASGI server, SQLAlchemy for database operations, and several other essential packages for authentication, WebSockets, and UI templating. I'll show you exactly which versions to use for optimal compatibility.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="1-2">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="1-2">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-plaintext"
                  ><code class="language-plaintext">fastapi==0.104.1
uvicorn[standard]==0.24.0
sqlalchemy==2.0.23
python-multipart==0.0.6
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-dotenv==1.0.0
jinja2==3.1.2
websockets==12.0</code></pre>
                </div>
                
              </div>
               
              <div class="step-item" data-step-id="1-3">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="1-3">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">1.3</div>
                    <div class="step-title-section">
                      <div class="step-title">Configuration Management</div>
                      
                      <div class="step-file">üìÅ app/utils/config.py</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Now we'll set up our configuration management system using Pydantic. This is a crucial step that will allow us to manage all our application settings in a type-safe way. We'll create a Settings class that inherits from BaseSettings, which automatically reads from environment variables. This approach is much more robust than hardcoding values and makes our application deployment-ready. You'll see how we define all the necessary configuration fields and add a helper method to parse allowed hosts.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="1-3">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="1-3">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-python"
                  ><code class="language-python">from pydantic_settings import BaseSettings
from typing import List, Optional
import os


class Settings(BaseSettings):
    # Basic app settings
    PROJECT_NAME: str
    VERSION: str
    DESCRIPTION: str
    API_V1_STR: str

    # Security
    SECRET_KEY: str
    ALGORITHM: str
    ACCESS_TOKEN_EXPIRE_MINUTES: int
    ALLOWED_HOSTS: str

    # Database
    DATABASE_URL: str

    @property
    def parsed_allowed_hosts(self) -&gt; List[str]:
        return [host.strip() for host in self.ALLOWED_HOSTS.split(&#34;,&#34;)]

    class Config:
        env_file = &#34;.env&#34;
        case_sensitive = True


settings = Settings()
</code></pre>
                </div>
                
              </div>
               
              <div class="step-item" data-step-id="1-4">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="1-4">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">1.4</div>
                    <div class="step-title-section">
                      <div class="step-title">Environment Configuration</div>
                      
                      <div class="step-file">üìÅ .env</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">With our Settings class in place, we now need to create our environment file. This .env file will contain all the configuration values that our application needs to run. I'll show you how to set up each variable properly, including the project metadata, security settings, database connection, and environment-specific configurations. This is where you'll customize the application for your specific needs, and I'll explain what each setting does and why it's important.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="1-4">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="1-4">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-plaintext"
                  ><code class="language-plaintext">PROJECT_NAME=FastAPI Chat App
VERSION=1.0.0
DESCRIPTION=A real-time chat application with WebSocket support
API_V1_STR=/api/v1
SECRET_KEY=your-super-secret-key-change-this-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
ALLOWED_HOSTS=http://localhost:8000,http://127.0.0.1:8000
DATABASE_URL=sqlite:///./app.db</code></pre>
                </div>
                
              </div>
              
            </div>
            
            <div class="phase-section">
              <div class="phase-header">
                <div class="phase-number">2</div>
                <h2 class="phase-title">Database & Models</h2>
              </div>

               
              <div class="step-item" data-step-id="2-1">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="2-1">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">2.1</div>
                    <div class="step-title-section">
                      <div class="step-title">Database Setup</div>
                      
                      <div class="step-file">üìÅ app/database.py</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Now let's set up our database layer using SQLAlchemy. This is where we'll create the database engine, session factory, and base class for our models. I'll show you how to configure the database connection using our settings, create a session maker for database operations, and set up a dependency function that will handle database sessions throughout our application. This foundation will allow us to perform all our database operations safely and efficiently.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="2-1">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="2-1">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-python"
                  ><code class="language-python">from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
from app.utils.config import settings

# Database setup
SQLALCHEMY_DATABASE_URL = settings.DATABASE_URL
engine = create_engine(SQLALCHEMY_DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
Base = declarative_base()

# Database dependency
def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

# Database initialization
def init_db():
    Base.metadata.create_all(bind=engine)</code></pre>
                </div>
                
              </div>
               
              <div class="step-item" data-step-id="2-2">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="2-2">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">2.2</div>
                    <div class="step-title-section">
                      <div class="step-title">User Model</div>
                      
                      <div class="step-file">üìÅ app/database.py</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">With our database setup complete, we'll now create our User model. This SQLAlchemy model will define the structure of our users table, including fields for username, password hash, and timestamps. I'll show you how to use SQLAlchemy's Column types, set up proper constraints like unique usernames, and add automatic timestamp handling. This model will be the foundation for our authentication system and user management features.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="2-2">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="2-2">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-python"
                  ><code class="language-python">from sqlalchemy import Column, Integer, String, DateTime
from sqlalchemy.sql import func
from app.database import Base

class User(Base):
    __tablename__ = &#34;users&#34;

    id = Column(Integer, primary_key=True, index=True)
    username = Column(String, unique=True, index=True, nullable=False)
    hashed_password = Column(String, nullable=False)
    created_at = Column(DateTime(timezone=True), server_default=func.now())</code></pre>
                </div>
                
              </div>
               
              <div class="step-item" data-step-id="2-3">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="2-3">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">2.3</div>
                    <div class="step-title-section">
                      <div class="step-title">CRUD Operations</div>
                      
                      <div class="step-file">üìÅ app/database.py</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Now we'll create our CRUD operations module. This file will contain all the database functions we need to interact with our User model. I'll show you how to implement functions for creating users, retrieving users by ID or username, and listing users with pagination. These functions will be used throughout our application for user registration, authentication, and user management. You'll see how to properly handle database sessions and implement common database patterns.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="2-3">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="2-3">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-python"
                  ><code class="language-python">from sqlalchemy.orm import Session
from app.models import User

def get_user(db: Session, user_id: int):
    return db.query(User).filter(User.id == user_id).first()

def get_user_by_username(db: Session, username: str):
    return db.query(User).filter(User.username == username).first()

def get_users(db: Session, skip: int = 0, limit: int = 100):
    return db.query(User).offset(skip).limit(limit).all()

def create_user(db: Session, username: str, hashed_password: str):
    db_user = User(username=username, hashed_password=hashed_password)
    db.add(db_user)
    db.commit()
    db.refresh(db_user)
    return db_user</code></pre>
                </div>
                
              </div>
              
            </div>
            
            <div class="phase-section">
              <div class="phase-header">
                <div class="phase-number">3</div>
                <h2 class="phase-title">Pydantic Schemas</h2>
              </div>

               
              <div class="step-item" data-step-id="3-1">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="3-1">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">3.1</div>
                    <div class="step-title-section">
                      <div class="step-title">Data Validation Schemas</div>
                      
                      <div class="step-file">üìÅ app/schemas.py</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Now we'll create our Pydantic schemas for data validation and serialization. These schemas will define the structure of our API requests and responses, ensuring type safety and proper validation. We'll create schemas for user registration, authentication, and WebSocket messages. I'll show you how to use Pydantic's validation features, including custom validators for usernames and passwords, and how to handle different data types properly.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="3-1">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="3-1">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-python"
                  ><code class="language-python">from pydantic import BaseModel, Field, field_validator, EmailStr, StringConstraints, ConfigDict
from typing import Optional, List, Annotated, Literal
from datetime import datetime, timezone
from enum import Enum


class MessageType(str, Enum):
    &#34;&#34;&#34;WebSocket message types&#34;&#34;&#34;
    MESSAGE = &#34;message&#34;
    GET_ONLINE_USERS = &#34;get_online_users&#34;
    USER_JOINED_ANIMATION = &#34;user_joined_animation&#34;
    ONLINE_USERS = &#34;online_users&#34;
    ERROR = &#34;error&#34;


class UserBase(BaseModel):
    username: Annotated[str, StringConstraints(min_length=3, max_length=16, strip_whitespace=True)] = Field(
        ...,
        description=&#34;Username must be 3-16 characters long&#34;,
        example=&#34;john_doe&#34;
    )

    @field_validator(&#39;username&#39;)
    @classmethod
    def validate_username(cls, v):
        return v.lower()  # Normalize to lowercase


class UserCreate(UserBase):
    password: Annotated[str, StringConstraints(min_length=4, max_length=24)] = Field(
        ...,
        description=&#34;Password must be 4-24 characters long&#34;,
        example=&#34;pass123&#34;
    )


class User(UserBase):
    &#34;&#34;&#34;User model for API responses (excludes sensitive data)&#34;&#34;&#34;
    id: int = Field(..., description=&#34;Unique user identifier&#34;)
    created_at: datetime = Field(..., description=&#34;Account creation timestamp&#34;)

    model_config = ConfigDict(
        frozen=True,
        from_attributes=True,
        json_encoders={datetime: lambda v: v.isoformat()}
    )

# Token schemas


class Token(BaseModel):
    access_token: str = Field(..., description=&#34;JWT access token&#34;)
    token_type: str = Field(default=&#34;bearer&#34;, description=&#34;Token type&#34;)
    expires_in: Optional[int] = Field(
        None, description=&#34;Token expiration time in seconds&#34;)

    model_config = ConfigDict(frozen=True)

# WebSocket message schemas


class WebSocketMessage(BaseModel):
    &#34;&#34;&#34;Base WebSocket message&#34;&#34;&#34;
    type: MessageType = Field(..., description=&#34;Message type&#34;)
    timestamp: Optional[datetime] = Field(
        default_factory=lambda: datetime.now(timezone.utc), description=&#34;Message timestamp&#34;)

    model_config = ConfigDict(
        frozen=True,
        json_encoders={datetime: lambda v: v.isoformat()}
    )


class ChatMessage(WebSocketMessage):
    &#34;&#34;&#34;Chat message for WebSocket&#34;&#34;&#34;
    type: Literal[MessageType.MESSAGE] = Field(
        default=MessageType.MESSAGE, description=&#34;Message type&#34;)
    content: Annotated[str, StringConstraints(min_length=1, max_length=1000, strip_whitespace=True)] = Field(
        ..., description=&#34;Message content (1-1000 characters)&#34;, example=&#34;Hello, how are you?&#34;
    )
    user_id: int = Field(..., description=&#34;Sender user ID&#34;)
    username: str = Field(..., description=&#34;Sender username&#34;)


class UserJoinMessage(WebSocketMessage):
    &#34;&#34;&#34;User join notification&#34;&#34;&#34;
    type: Literal[MessageType.USER_JOINED_ANIMATION] = Field(
        default=MessageType.USER_JOINED_ANIMATION, description=&#34;Message type&#34;)
    user_id: int = Field(..., description=&#34;User ID&#34;)
    username: str = Field(..., description=&#34;Username&#34;)


class OnlineUser(BaseModel):
    &#34;&#34;&#34;Individual online user&#34;&#34;&#34;
    user_id: int = Field(..., description=&#34;User ID&#34;)
    username: str = Field(..., description=&#34;Username&#34;)

    model_config = ConfigDict(frozen=True)


class OnlineUsersMessage(WebSocketMessage):
    &#34;&#34;&#34;Online users list&#34;&#34;&#34;
    type: Literal[MessageType.ONLINE_USERS] = Field(
        default=MessageType.ONLINE_USERS, description=&#34;Message type&#34;)
    users: List[OnlineUser] = Field(..., description=&#34;List of online users&#34;)


class ErrorMessage(WebSocketMessage):
    &#34;&#34;&#34;Error message&#34;&#34;&#34;
    type: Literal[MessageType.ERROR] = Field(
        default=MessageType.ERROR, description=&#34;Message type&#34;)
    message: str = Field(..., description=&#34;Error message&#34;)
</code></pre>
                </div>
                
              </div>
              
            </div>
            
            <div class="phase-section">
              <div class="phase-header">
                <div class="phase-number">4</div>
                <h2 class="phase-title">Authentication System</h2>
              </div>

               
              <div class="step-item" data-step-id="4-1">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="4-1">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">4.1</div>
                    <div class="step-title-section">
                      <div class="step-title">Password Security</div>
                      
                      <div class="step-file">üìÅ app/auth.py</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Security is crucial for any chat application, so let's implement secure password handling using bcrypt. This module will provide functions for hashing passwords and verifying them during login. I'll show you how to use the passlib library with bcrypt, which is one of the most secure hashing algorithms available. We'll set up the password context with proper configuration and create two main functions: one for hashing new passwords and another for verifying existing ones.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="4-1">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="4-1">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-python"
                  ><code class="language-python">from datetime import datetime, timedelta
from typing import Any, Union, Optional
from fastapi import Depends, HTTPException, status
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from jose import jwt, JWTError
from passlib.context import CryptContext
from sqlalchemy.orm import Session
from app.utils.config import settings
from app.database import get_db, get_user


# Password hashing
pwd_context = CryptContext(schemes=[&#34;bcrypt&#34;], deprecated=&#34;auto&#34;)

def verify_password(plain_password: str, hashed_password: str) -&gt; bool:
    return pwd_context.verify(plain_password, hashed_password)

def get_password_hash(password: str) -&gt; str:
    return pwd_context.hash(password)

# JWT token functions
def create_access_token(
    subject: Union[str, Any], expires_delta: timedelta = None
) -&gt; str:
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(
            minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES
        )
    to_encode = {&#34;exp&#34;: expire, &#34;sub&#34;: str(subject)}
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
    return encoded_jwt

def verify_token(token: str, db: Session) -&gt; Optional[Any]:
    &#34;&#34;&#34;Verify JWT token and return user&#34;&#34;&#34;
    try:
        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
        user_id: str = payload.get(&#34;sub&#34;)
        if user_id is None:
            return None
    except JWTError:
        return None
    
    user = get_user(db, user_id=int(user_id))
    return user

# Dependencies
security = HTTPBearer()

def get_current_user(
    credentials: HTTPAuthorizationCredentials = Depends(security),
    db: Session = Depends(get_db)
):
    credentials_exception = HTTPException(
        status_code=status.HTTP_401_UNAUTHORIZED,
        detail=&#34;Could not validate credentials&#34;,
        headers={&#34;WWW-Authenticate&#34;: &#34;Bearer&#34;},
    )
    
    user = verify_token(credentials.credentials, db)
    if user is None:
        raise credentials_exception
    return user

def get_current_active_user(current_user = Depends(get_current_user)):
    return current_user</code></pre>
                </div>
                
              </div>
              
            </div>
            
            <div class="phase-section">
              <div class="phase-header">
                <div class="phase-number">5</div>
                <h2 class="phase-title">WebSocket Management</h2>
              </div>

               
              <div class="step-item" data-step-id="5-1">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="5-1">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">5.1</div>
                    <div class="step-title-section">
                      <div class="step-title">WebSocket Connection Manager</div>
                      
                      <div class="step-file">üìÅ app/utils/websocket_manager.py</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">This is where the magic happens! We'll create our WebSocket connection manager that will handle all real-time communication in our chat application. This class will manage active WebSocket connections, broadcast messages to all connected users, and handle user join/leave events with beautiful animations. I'll show you how to implement a robust connection manager that can handle multiple users, gracefully manage disconnections, and provide real-time features like online user lists and message broadcasting. This is the core of our real-time chat functionality.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="5-1">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="5-1">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-python"
                  ><code class="language-python">from fastapi import WebSocket, WebSocketDisconnect
from typing import Dict, List
import json
from datetime import datetime
from app.database import User
from app.schemas import ChatMessage, UserJoinMessage, OnlineUsersMessage, ErrorMessage


class ConnectionManager:
    def __init__(self):
        # Store active connections: {user_id: WebSocket}
        self.active_connections: Dict[int, WebSocket] = {}
        self.user_info: Dict[int, dict] = {}

    async def connect(self, websocket: WebSocket, user: User):
        user_id = user.id
        self.active_connections[user_id] = websocket
        self.user_info[user_id] = {
            &#34;username&#34;: user.username,
            &#34;is_online&#34;: True
        }

        # Send join notification to all other users (for animation effect)
        await self.broadcast_join_notification(user_id, user.username)

        # Update online users list for all connected users
        await self.broadcast_online_users_update()

    def disconnect(self, user_id: int):
        if user_id in self.active_connections:
            del self.active_connections[user_id]
        if user_id in self.user_info:
            del self.user_info[user_id]
        return None

    async def disconnect_user(self, user_id: int):
        &#34;&#34;&#34;Disconnect user and update online users list for remaining users&#34;&#34;&#34;
        self.disconnect(user_id)
        # Update online users list for all remaining connected users
        await self.broadcast_online_users_update()

    async def send_personal_message(self, message: dict, user_id: int):
        &#34;&#34;&#34;Send message to a single user (system messages)&#34;&#34;&#34;
        if user_id in self.active_connections:
            try:
                await self.active_connections[user_id].send_text(json.dumps(message))
            except:
                # Connection might be closed
                pass

    async def broadcast_message(self, message: dict):
        &#34;&#34;&#34;Send message to all connected users&#34;&#34;&#34;
        disconnected_users = []
        for user_id, connection in self.active_connections.items():
            try:
                await connection.send_text(json.dumps(message))
            except:
                disconnected_users.append(user_id)

        # Clean up disconnected users
        for user_id in disconnected_users:
            self.disconnect(user_id)

    async def broadcast_join_notification(self, new_user_id: int, new_username: str):
        &#34;&#34;&#34;Broadcast join notification to all users except the new user&#34;&#34;&#34;
        join_message = UserJoinMessage(
            user_id=new_user_id,
            username=new_username
        )

        for user_id in self.active_connections.keys():
            if user_id != new_user_id:  # Don&#39;t send to the new user
                await self.send_personal_message(join_message.model_dump(), user_id)

    async def broadcast_online_users_update(self):
        &#34;&#34;&#34;Broadcast updated online users list to all connected users&#34;&#34;&#34;
        for user_id in self.active_connections.keys():
            online_users = self.get_online_users(exclude_user_id=user_id)
            online_users_message = OnlineUsersMessage(users=online_users)
            await self.send_personal_message(online_users_message.model_dump(), user_id)

    def get_online_users(self, exclude_user_id: int = None) -&gt; List[dict]:
        &#34;&#34;&#34;Get list of online users, optionally excluding a specific user&#34;&#34;&#34;
        return [
            {
                &#34;user_id&#34;: user_id,
                &#34;username&#34;: info[&#34;username&#34;]
            }
            for user_id, info in self.user_info.items()
            if exclude_user_id is None or user_id != exclude_user_id
        ]

    async def handle_websocket_message(self, websocket: WebSocket, user_id: int, data: dict):
        &#34;&#34;&#34;Handle incoming WebSocket messages&#34;&#34;&#34;
        message_type = data.get(&#34;type&#34;)

        if message_type == &#34;message&#34;:
            try:
                # Validate message using Pydantic schema
                chat_message = ChatMessage(
                    content=data.get(&#34;content&#34;, &#34;&#34;),
                    user_id=user_id,
                    username=self.user_info[user_id][&#34;username&#34;]
                )

                # Broadcast validated message
                await self.broadcast_message(chat_message.model_dump())

            except Exception as e:
                # Send validation error to the user
                error_message = ErrorMessage(
                    message=&#34;Invalid message format or content too long&#34;)
                await self.send_personal_message(error_message.model_dump(), user_id)

        elif message_type == &#34;get_online_users&#34;:
            online_users = self.get_online_users(exclude_user_id=user_id)
            print(
                f&#34;User {user_id} requested online users. Found: {len(online_users)} users&#34;)
            online_users_message = OnlineUsersMessage(users=online_users)
            await self.send_personal_message(online_users_message.model_dump(), user_id)


# Global connection manager instance
manager = ConnectionManager()
</code></pre>
                </div>
                
              </div>
              
            </div>
            
            <div class="phase-section">
              <div class="phase-header">
                <div class="phase-number">6</div>
                <h2 class="phase-title">HTTP & WebSocket Routes</h2>
              </div>

               
              <div class="step-item" data-step-id="6-1">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="6-1">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">6.1</div>
                    <div class="step-title-section">
                      <div class="step-title">Authentication Routes</div>
                      
                      <div class="step-file">üìÅ app/routes.py</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Now let's create our authentication routes. These HTTP endpoints will handle user registration, login, and user profile access. I'll show you how to implement secure registration with password hashing, login with JWT token generation, and a protected endpoint to get the current user's information. We'll use FastAPI's form handling for login and proper error responses for various scenarios. These routes will be the entry point for users to access our chat application.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="6-1">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="6-1">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-python"
                  ><code class="language-python">from fastapi import APIRouter, Depends, HTTPException, status, WebSocket, WebSocketDisconnect, Form
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from sqlalchemy.orm import Session
from typing import List
from app.auth import get_current_active_user, create_access_token, verify_password, get_password_hash, verify_token
from app.database import get_db, get_user_by_username, create_user, get_users
from app.schemas import User, UserCreate, Token
from app.utils.websocket_manager import manager
from app.utils.config import settings

router = APIRouter()

# HTTP Routes


@router.post(&#34;/auth/register&#34;, response_model=User)
def register(user: UserCreate, db: Session = Depends(get_db)):
    db_user = get_user_by_username(db, username=user.username)
    if db_user:
        raise HTTPException(
            status_code=400, detail=&#34;Username already registered&#34;)

    hashed_password = get_password_hash(user.password)
    db_user = create_user(db, username=user.username,
                          hashed_password=hashed_password)
    return db_user


@router.post(&#34;/auth/login&#34;, response_model=Token)
def login(username: str = Form(...), password: str = Form(...), db: Session = Depends(get_db)):
    user = get_user_by_username(db, username=username)
    if not user or not verify_password(password, user.hashed_password):
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail=&#34;Incorrect username or password&#34;,
            headers={&#34;WWW-Authenticate&#34;: &#34;Bearer&#34;},
        )

    access_token = create_access_token(subject=user.id)
    return {&#34;access_token&#34;: access_token, &#34;token_type&#34;: &#34;bearer&#34;}


@router.get(&#34;/auth/me&#34;, response_model=User)
def read_users_me(current_user: User = Depends(get_current_active_user)):
    return current_user


@router.get(&#34;/users&#34;, response_model=List[User])
def read_users(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):
    users = get_users(db, skip=skip, limit=limit)
    return users

# WebSocket Routes


@router.websocket(&#34;/chat/ws/{token}&#34;)
async def websocket_endpoint(websocket: WebSocket, token: str):
    await websocket.accept()

    # Verify token and get user
    db = next(get_db())
    user = verify_token(token, db)
    if not user:
        await websocket.close(code=status.WS_1008_POLICY_VIOLATION)
        return

    # Add user to WebSocket manager
    await manager.connect(websocket, user)

    try:
        while True:
            data = await websocket.receive_text()
            import json
            data_dict = json.loads(data)
            await manager.handle_websocket_message(websocket, user.id, data_dict)
    except WebSocketDisconnect:
        await manager.disconnect_user(user.id)</code></pre>
                </div>
                
              </div>
              
            </div>
            
            <div class="phase-section">
              <div class="phase-header">
                <div class="phase-number">7</div>
                <h2 class="phase-title">Modern UI - CSS Styling</h2>
              </div>

               
              <div class="step-item" data-step-id="7-1">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="7-1">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">7.1</div>
                    <div class="step-title-section">
                      <div class="step-title">Base CSS Styling</div>
                      
                      <div class="step-file">üìÅ static/css/base.css</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Now let's create the foundation of our beautiful UI with our base CSS file. This will establish our dark theme, typography, and common component styles. I'll show you how to create a modern, cohesive design system with proper color schemes, typography, and interactive elements. We'll set up the base styles for buttons, form inputs, and other common components that will be used throughout our application. This creates the foundation for our glass morphism effects and modern chat interface.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="7-1">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="7-1">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-css"
                  ><code class="language-css">/* Reset and base styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #303c52 0%, #455c81 100%);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Common form styles */
.form-group {
  margin-bottom: 20px;
}

label {
  display: block;
  margin-bottom: 8px;
  color: #e2e8f0;
  font-weight: 500;
}

input {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #4a5568;
  border-radius: 10px;
  font-size: 16px;
  transition: all 0.3s ease;
  background: #2d3748;
  color: #e2e8f0;
}

input:focus {
  outline: none;
  border-color: #a0aec0;
  box-shadow: 0 0 0 3px rgba(160, 174, 192, 0.1);
}

button {
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
  color: #1a202c;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-bottom: 15px;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(160, 174, 192, 0.3);
}

button:active {
  transform: translateY(0);
}

/* Responsive design */
@media (max-width: 768px) {
  .container {
    margin: 20px;
    padding: 30px;
  }
}</code></pre>
                </div>
                
              </div>
               
              <div class="step-item" data-step-id="7-2">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="7-2">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">7.2</div>
                    <div class="step-title-section">
                      <div class="step-title">Chat Interface Styling</div>
                      
                      <div class="step-file">üìÅ static/css/app.css</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Now we'll create the specific styles for our chat application interface. This CSS file will implement the beautiful glass morphism effects, modern chat layout, and smooth animations that make our application stand out. I'll show you how to create the chat container with proper styling, implement the sidebar for online users, add custom scrollbars, and create smooth animations for user join events. This is where we bring the modern, professional look to our chat application with attention to detail and user experience.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="7-2">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="7-2">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-css"
                  ><code class="language-css">/* Auth page specific styles */
.auth-container {
  background: rgba(45, 55, 72, 0.95);
  border-radius: 20px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  padding: 40px;
  width: 100%;
  max-width: 400px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(160, 174, 192, 0.2);
}

.auth-form h2 {
  text-align: center;
  color: #e2e8f0;
  margin-bottom: 30px;
  font-size: 2.5em;
  font-weight: 300;
}

.auth-link {
  text-align: center;
  margin-top: 20px;
  color: #a0aec0;
}

.auth-link a {
  color: #a0aec0;
  text-decoration: none;
  font-weight: 500;
  transition: color 0.3s ease;
}

.auth-link a:hover {
  color: #e2e8f0;
}

/* Chat page specific styles */
.chat-container {
  background: rgba(26, 32, 44, 0.95);
  border-radius: 20px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  width: 100%;
  max-width: 1200px;
  height: 600px;
  display: flex;
  flex-direction: column;
  backdrop-filter: blur(10px);
  overflow: hidden;
}

.logout-btn {
  background: rgba(239, 68, 68, 0.2);
  border: 1px solid rgba(239, 68, 68, 0.4);
  color: #fecaca;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  width: auto;
  margin: 0;
}

.logout-btn:hover {
  background: rgba(239, 68, 68, 0.3);
  border-color: rgba(239, 68, 68, 0.6);
  color: #fca5a5;
  transform: none;
  box-shadow: none;
}

/* Chat Layout */
.chat-layout {
  display: flex;
  flex: 1;
  height: 100%;
}

.chat-area {
  flex: 2;
  display: flex;
  flex-direction: column;
  border-right: 1px solid #4a5568;
  border-radius: 0 0 0 20px;
}

.sidebar {
  flex: 1;
  background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
  border-left: 1px solid rgba(160, 174, 192, 0.2);
  position: relative;
}

.sidebar::before {
  content: &#39;&#39;;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(
    90deg,
    transparent 0%,
    rgba(160, 174, 192, 0.3) 50%,
    transparent 100%
  );
}

.sidebar-header {
  display: flex;
  flex-direction: column;
  position: relative;
  width: 100%;
  margin: 0;
}

.user-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(70, 80, 99, 0.3);
  padding: 10px 14px;
  width: 100%;
  margin: 0;
  margin-bottom: 20px;
}

.logged-in-as {
  font-size: 13px;
  color: #a0aec0;
  font-weight: 500;
  letter-spacing: 0.3px;
}

.logged-in-as span {
  color: #4a90e2;
  font-weight: 600;
  text-shadow: 0 0 10px rgba(74, 144, 226, 0.3);
}

.online-users-label {
  margin: 0;
  font-size: 11px;
  color: #4d5868;
  font-weight: 400;
  text-transform: uppercase;
  letter-spacing: 1px;
  text-align: right;
  font-style: italic;
  font-family: &#39;Script&#39;, sans-serif;
  padding-right: 8px;
  padding-bottom: 7px;
}

.online-users {
  display: flex;
  flex-direction: column;
  gap: 10px;
  overflow-y: auto;
  max-height: calc(100vh - 250px);
  padding-right: 8px;
  padding-bottom: 40px;
}

.online-users::-webkit-scrollbar {
  width: 6px;
}

.online-users::-webkit-scrollbar-track {
  background: rgba(26, 32, 44, 0.3);
  border-radius: 3px;
}

.online-users::-webkit-scrollbar-thumb {
  background: rgba(160, 174, 192, 0.3);
  border-radius: 3px;
}

.online-users::-webkit-scrollbar-thumb:hover {
  background: rgba(160, 174, 192, 0.5);
}

.online-user {
  padding: 12px 16px;
  background: rgba(26, 32, 44, 0.8);
  border: 1px solid rgba(160, 174, 192, 0.15);
  border-radius: 10px;
  font-size: 14px;
  color: #e2e8f0;
  font-weight: 500;
  transition: all 0.3s ease;
  position: relative;
  backdrop-filter: blur(5px);
}

.online-user.joining {
  animation: userJoin 800ms ease-out;
}

@keyframes userJoin {
  0% {
    background: rgba(54, 108, 170, 0.3);
    border-color: #4a91e27c;
    box-shadow: 0 0 10px rgba(37, 78, 124, 0.5);
    opacity: 0.6;
  }
  50% {
    background: rgba(74, 144, 226, 0.2);
    border-color: #4a90e2;
    box-shadow: 0 0 15px rgba(53, 106, 167, 0.7);
    opacity: 0.9;
  }
  100% {
    background: rgba(26, 32, 44, 0.8);
    border-color: rgba(160, 174, 192, 0.15);
    box-shadow: none;
    opacity: 1;
  }
}

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.message {
  max-width: 70%;
  padding: 12px 16px;
  border-radius: 15px;
  word-wrap: break-word;
}

.message.own {
  align-self: flex-end;
  background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
  color: white;
}

.message.other {
  align-self: flex-start;
  background: rgba(45, 55, 72, 0.8);
  color: #e2e8f0;
  border: 1px solid rgba(160, 174, 192, 0.2);
}

.message-header {
  font-size: 12px;
  font-weight: 600;
  margin-bottom: 4px;
  opacity: 0.8;
}

.message-content {
  font-size: 14px;
  line-height: 1.4;
}

.chat-input-container {
  padding: 20px;
  border-top: 1px solid #4a5568;
}

.chat-input-form {
  display: flex;
  gap: 10px;
  align-items: center;
}

.chat-input {
  flex: 1;
  padding: 12px 16px;
  border: 2px solid #4a5568;
  border-radius: 25px;
  background: rgba(26, 32, 44, 0.8);
  color: #e2e8f0;
  font-size: 14px;
  transition: all 0.3s ease;
}

.chat-input::placeholder {
  color: #a0aec0;
}

.chat-input:focus {
  outline: none;
  border-color: #4a90e2;
  box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
  background: rgba(45, 55, 72, 0.9);
}

.send-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
  color: white;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  transition: all 0.3s ease;
  margin: 0;
}

.send-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 4px 15px rgba(74, 144, 226, 0.4);
}

.send-btn:active {
  transform: scale(0.95);
}</code></pre>
                </div>
                
              </div>
              
            </div>
            
            <div class="phase-section">
              <div class="phase-header">
                <div class="phase-number">8</div>
                <h2 class="phase-title">JavaScript Functionality</h2>
              </div>

               
              <div class="step-item" data-step-id="8-1">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="8-1">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">8.1</div>
                    <div class="step-title-section">
                      <div class="step-title">Common JavaScript Utilities</div>
                      
                      <div class="step-file">üìÅ static/js/common.js</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Let's create our common JavaScript utilities that will be shared across our application. This file will contain helper functions for authentication, API requests, and common UI operations. I'll show you how to implement token management for local storage, authentication state checking, and a reusable API request function that automatically handles authentication headers. These utilities will make our frontend code cleaner and more maintainable by centralizing common functionality.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="8-1">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="8-1">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-javascript"
                  ><code class="language-javascript">// Common utilities and constants
const API_BASE = &#39;http://localhost:8000/api/v1&#39;;

// Utility functions
function showAlert(message, type = &#39;info&#39;) {
  console.log(`${type.toUpperCase()}: ${message}`);
  alert(message);
}

function redirectTo(url) {
  window.location.href = url;
}

// Check if user is authenticated
function isAuthenticated() {
  return localStorage.getItem(&#39;token&#39;) !== null;
}

// Get stored token
function getToken() {
  return localStorage.getItem(&#39;token&#39;);
}

// Store token
function storeToken(token) {
  localStorage.setItem(&#39;token&#39;, token);
}

// Remove token
function removeToken() {
  localStorage.removeItem(&#39;token&#39;);
}

// API request helper
async function apiRequest(endpoint, options = {}) {
  const token = getToken();
  const defaultHeaders = {
    &#39;Content-Type&#39;: &#39;application/json&#39;,
  };

  if (token) {
    defaultHeaders[&#39;Authorization&#39;] = `Bearer ${token}`;
  }

  const config = {
    headers: { ...defaultHeaders, ...options.headers },
    ...options,
  };

  try {
    const response = await fetch(`${API_BASE}${endpoint}`, config);

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.detail || &#39;Request failed&#39;);
    }

    return await response.json();
  } catch (error) {
    console.error(&#39;API request error:&#39;, error);
    throw error;
  }
}</code></pre>
                </div>
                
              </div>
               
              <div class="step-item" data-step-id="8-2">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="8-2">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">8.2</div>
                    <div class="step-title-section">
                      <div class="step-title">Login Functionality</div>
                      
                      <div class="step-file">üìÅ static/js/login.js</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Now we'll implement the login functionality. This JavaScript file will handle user authentication, form validation, and token management. I'll show you how to implement secure login with proper error handling, form data submission, and automatic redirection after successful authentication. We'll also add keyboard support for better user experience and proper token storage for session management.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="8-2">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="8-2">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-javascript"
                  ><code class="language-javascript">// Login functionality
async function login() {
  const username = document.getElementById(&#39;username&#39;).value;
  const password = document.getElementById(&#39;password&#39;).value;

  if (!username || !password) {
    showAlert(&#39;Please enter both username and password&#39;);
    return;
  }

  try {
    const response = await fetch(`${API_BASE}/auth/login`, {
      method: &#39;POST&#39;,
      headers: {
        &#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39;,
      },
      body: `username=${encodeURIComponent(username)}&amp;password=${encodeURIComponent(password)}`,
    });

    if (response.ok) {
      const data = await response.json();
      storeToken(data.access_token);
      redirectTo(&#39;/chat&#39;);
    } else {
      const error = await response.json();
      showAlert(error.detail || &#39;Login failed. Please check your credentials.&#39;);
    }
  } catch (error) {
    console.error(&#39;Login error:&#39;, error);
    showAlert(&#39;Login failed. Please try again.&#39;);
  }
}

// Handle Enter key in login form
document.addEventListener(&#39;DOMContentLoaded&#39;, function () {
  const passwordInput = document.getElementById(&#39;password&#39;);
  if (passwordInput) {
    passwordInput.addEventListener(&#39;keypress&#39;, function (event) {
      if (event.key === &#39;Enter&#39;) {
        login();
      }
    });
  }
});</code></pre>
                </div>
                
              </div>
               
              <div class="step-item" data-step-id="8-3">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="8-3">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">8.3</div>
                    <div class="step-title-section">
                      <div class="step-title">Registration Functionality</div>
                      
                      <div class="step-file">üìÅ static/js/register.js</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Now we'll implement the registration functionality. This JavaScript file will handle user registration with proper validation, password confirmation, and error handling. I'll show you how to implement client-side validation for password matching and length requirements, secure form submission, and proper user feedback. We'll also add keyboard support and automatic redirection after successful registration.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="8-3">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="8-3">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-javascript"
                  ><code class="language-javascript">// Registration functionality
async function register() {
  const username = document.getElementById(&#39;username&#39;).value;
  const password = document.getElementById(&#39;password&#39;).value;
  const confirmPassword = document.getElementById(&#39;confirmPassword&#39;).value;

  if (!username || !password || !confirmPassword) {
    showAlert(&#39;Please fill in all fields&#39;);
    return;
  }

  if (password !== confirmPassword) {
    showAlert(&#39;Passwords do not match&#39;);
    return;
  }

  if (password.length &lt; 4) {
    showAlert(&#39;Password must be at least 4 characters long&#39;);
    return;
  }

  try {
    const response = await fetch(`${API_BASE}/auth/register`, {
      method: &#39;POST&#39;,
      headers: {
        &#39;Content-Type&#39;: &#39;application/json&#39;,
      },
      body: JSON.stringify({
        username,
        password,
      }),
    });

    if (response.ok) {
      showAlert(&#39;Registration successful! Please login.&#39;, &#39;success&#39;);
      redirectTo(&#39;/login&#39;);
    } else {
      const error = await response.json();
      showAlert(error.detail || &#39;Registration failed&#39;);
    }
  } catch (error) {
    console.error(&#39;Registration error:&#39;, error);
    showAlert(&#39;Registration failed. Please try again.&#39;);
  }
}

// Handle Enter key in register form
document.addEventListener(&#39;DOMContentLoaded&#39;, function () {
  const confirmPasswordInput = document.getElementById(&#39;confirmPassword&#39;);
  if (confirmPasswordInput) {
    confirmPasswordInput.addEventListener(&#39;keypress&#39;, function (event) {
      if (event.key === &#39;Enter&#39;) {
        register();
      }
    });
  }
});</code></pre>
                </div>
                
              </div>
               
              <div class="step-item" data-step-id="8-4">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="8-4">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">8.4</div>
                    <div class="step-title-section">
                      <div class="step-title">WebSocket Chat Implementation</div>
                      
                      <div class="step-file">üìÅ static/js/chat.js</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Now we'll implement the core chat functionality with WebSocket communication. This JavaScript file will handle connecting to our WebSocket endpoint, managing real-time message sending and receiving, and implementing beautiful user join animations. I'll show you how to establish WebSocket connections with proper authentication, handle different message types, update the online users list in real-time, and create smooth animations when users join the chat. This brings all our backend functionality to life in the frontend.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="8-4">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="8-4">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-javascript"
                  ><code class="language-javascript">// Simple Chat functionality
let ws = null;
let currentUser = null;

// Initialize chat when page loads
document.addEventListener(&#39;DOMContentLoaded&#39;, function () {
  if (!isAuthenticated()) {
    redirectTo(&#39;/login&#39;);
    return;
  }
  initializeChat();
});

async function initializeChat() {
  try {
    currentUser = await apiRequest(&#39;/auth/me&#39;);
    // Update the current username display
    const usernameElement = document.getElementById(&#39;current-username&#39;);
    if (usernameElement) {
      usernameElement.textContent = currentUser.username;
    }
    connectWebSocket();
  } catch (error) {
    console.error(&#39;Failed to initialize chat:&#39;, error);
    removeToken();
    redirectTo(&#39;/login&#39;);
  }
}

function connectWebSocket() {
  const token = getToken();
  ws = new WebSocket(`ws://localhost:8000/api/v1/chat/ws/${token}`);

  ws.onopen = function () {
    console.log(&#39;Connected to chat&#39;);
    loadOnlineUsers();
  };

  ws.onmessage = function (event) {
    const data = JSON.parse(event.data);
    handleWebSocketMessage(data);
  };

  ws.onclose = function () {
    console.log(&#39;Disconnected from chat&#39;);
  };

  ws.onerror = function (error) {
    console.error(&#39;WebSocket error:&#39;, error);
  };
}

function handleWebSocketMessage(data) {
  console.log(&#39;Received WebSocket message:&#39;, data.type, data);
  switch (data.type) {
    case &#39;message&#39;:
      if (data.user_id === currentUser.id) {
        addMessage(data.content, &#39;You&#39;, &#39;own&#39;);
      } else {
        addMessage(data.content, data.username, &#39;other&#39;);
      }
      break;
    case &#39;user_joined_animation&#39;:
      console.log(&#39;Received join animation for:&#39;, data.username);
      // Store the username to highlight after online users update
      window.pendingHighlight = data.username;
      break;
    case &#39;online_users&#39;:
      updateOnlineUsers(data.users);
      // Check if we need to highlight a new user
      if (window.pendingHighlight) {
        setTimeout(() =&gt; {
          highlightNewUser(window.pendingHighlight);
          window.pendingHighlight = null;
        }, 100); // Small delay to ensure DOM is updated
      }
      break;
  }
}

function addMessage(content, username, type) {
  const messagesContainer = document.getElementById(&#39;messages&#39;);
  const messageDiv = document.createElement(&#39;div&#39;);
  messageDiv.className = `message ${type}`;

  const headerDiv = document.createElement(&#39;div&#39;);
  headerDiv.className = &#39;message-header&#39;;
  headerDiv.textContent = username;

  const contentDiv = document.createElement(&#39;div&#39;);
  contentDiv.className = &#39;message-content&#39;;
  contentDiv.textContent = content;

  messageDiv.appendChild(headerDiv);
  messageDiv.appendChild(contentDiv);

  messagesContainer.appendChild(messageDiv);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

function sendMessage() {
  const messageInput = document.getElementById(&#39;messageInput&#39;);
  const content = messageInput.value.trim();

  if (content &amp;&amp; ws &amp;&amp; ws.readyState === WebSocket.OPEN) {
    ws.send(
      JSON.stringify({
        type: &#39;message&#39;,
        content: content,
      })
    );
    messageInput.value = &#39;&#39;;
  }
}

// Handle form submission
document.addEventListener(&#39;DOMContentLoaded&#39;, function () {
  const messageForm = document.getElementById(&#39;messageForm&#39;);
  if (messageForm) {
    messageForm.addEventListener(&#39;submit&#39;, function (e) {
      e.preventDefault();
      sendMessage();
    });
  }
});

function loadOnlineUsers() {
  if (ws &amp;&amp; ws.readyState === WebSocket.OPEN) {
    ws.send(
      JSON.stringify({
        type: &#39;get_online_users&#39;,
      })
    );
  }
}

function updateOnlineUsers(users) {
  const onlineUsersContainer = document.getElementById(&#39;online-users&#39;);
  if (!onlineUsersContainer) return;

  onlineUsersContainer.innerHTML = &#39;&#39;;

    // Filter out the current user from the list
    const otherUsers = users.filter((user) =&gt; user.id !== currentUser.id);

  otherUsers.forEach((user) =&gt; {
    const userDiv = document.createElement(&#39;div&#39;);
    userDiv.className = &#39;online-user&#39;;
    userDiv.textContent = user.username;
    userDiv.dataset.username = user.username; // Add data attribute for easy finding
    onlineUsersContainer.appendChild(userDiv);
  });
}

function highlightNewUser(username) {
  console.log(&#39;Highlighting new user:&#39;, username);
  const onlineUsersContainer = document.getElementById(&#39;online-users&#39;);
  if (!onlineUsersContainer) {
    console.log(&#39;Online users container not found&#39;);
    return;
  }

  // Find the user element by username
  const userElements = onlineUsersContainer.querySelectorAll(&#39;.online-user&#39;);
  console.log(&#39;Found user elements:&#39;, userElements.length);
  const userElement = Array.from(userElements).find((el) =&gt; el.textContent === username);

  if (userElement) {
    console.log(&#39;Found user element, adding joining class&#39;);
    // Add the joining class to trigger the animation
    userElement.classList.add(&#39;joining&#39;);

    // Remove the class after animation completes
    setTimeout(() =&gt; {
      userElement.classList.remove(&#39;joining&#39;);
      console.log(&#39;Removed joining class&#39;);
    }, 2000); // Match the animation duration
  } else {
    console.log(&#39;User element not found for:&#39;, username);
  }
}

function logout() {
  if (ws) {
    ws.close();
  }
  removeToken();
  redirectTo(&#39;/login&#39;);
}</code></pre>
                </div>
                
              </div>
              
            </div>
            
            <div class="phase-section">
              <div class="phase-header">
                <div class="phase-number">9</div>
                <h2 class="phase-title">HTML Templates</h2>
              </div>

               
              <div class="step-item" data-step-id="9-1">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="9-1">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">9.1</div>
                    <div class="step-title-section">
                      <div class="step-title">Login Page Template</div>
                      
                      <div class="step-file">üìÅ templates/login.html</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Now let's create our login page template. This HTML template will provide a clean, modern interface for user authentication with proper form structure and styling integration. I'll show you how to structure the HTML for optimal user experience, including proper semantic markup, accessibility considerations, and integration points for our CSS and JavaScript. This template will be rendered by our FastAPI application and will serve as the entry point for user authentication.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="9-1">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="9-1">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-markup"
                  ><code class="language-markup">&lt;!DOCTYPE html&gt;
&lt;html lang=&#34;en&#34;&gt;
  &lt;head&gt;
    &lt;meta charset=&#34;UTF-8&#34; /&gt;
    &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34; /&gt;
    &lt;title&gt;Login - FastAPI Chat App&lt;/title&gt;
    &lt;link
      rel=&#34;icon&#34;
      href=&#34;data:image/svg+xml,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; viewBox=&#39;0 0 100 100&#39;&gt;&lt;text y=&#39;.9em&#39; font-size=&#39;90&#39;&gt;üí¨&lt;/text&gt;&lt;/svg&gt;&#34;
    /&gt;
    &lt;link rel=&#34;stylesheet&#34; href=&#34;/static/css/base.css&#34; /&gt;
    &lt;link rel=&#34;stylesheet&#34; href=&#34;/static/css/app.css&#34; /&gt;
  &lt;/head&gt;
  &lt;body&gt;
&lt;div class=&#34;auth-container&#34;&gt;
  &lt;div class=&#34;auth-form&#34;&gt;
    &lt;h2&gt;Login to Chat&lt;/h2&gt;
    &lt;div class=&#34;form-group&#34;&gt;
      &lt;label for=&#34;username&#34;&gt;Username:&lt;/label&gt;
      &lt;input type=&#34;text&#34; id=&#34;username&#34; placeholder=&#34;Enter your username&#34; /&gt;
    &lt;/div&gt;
    &lt;div class=&#34;form-group&#34;&gt;
      &lt;label for=&#34;password&#34;&gt;Password:&lt;/label&gt;
      &lt;input type=&#34;password&#34; id=&#34;password&#34; placeholder=&#34;Enter your password&#34; /&gt;
    &lt;/div&gt;
    &lt;button class=&#34;btn btn-primary&#34; onclick=&#34;login()&#34;&gt;Login&lt;/button&gt;
    &lt;p class=&#34;auth-link&#34;&gt;Don&#39;t have an account? &lt;a href=&#34;/register&#34;&gt;Register&lt;/a&gt;&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;

    &lt;script src=&#34;/static/js/common.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;/static/js/login.js&#34;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
                </div>
                
              </div>
               
              <div class="step-item" data-step-id="9-2">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="9-2">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">9.2</div>
                    <div class="step-title-section">
                      <div class="step-title">Registration Page Template</div>
                      
                      <div class="step-file">üìÅ templates/register.html</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Now let's create our registration page template. This HTML template will provide a user-friendly interface for new user registration with proper form validation and styling. I'll show you how to structure the registration form with password confirmation, proper labeling, and integration with our JavaScript validation. This template will ensure a smooth user experience during the registration process.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="9-2">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="9-2">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-markup"
                  ><code class="language-markup">&lt;!DOCTYPE html&gt;
&lt;html lang=&#34;en&#34;&gt;
  &lt;head&gt;
    &lt;meta charset=&#34;UTF-8&#34; /&gt;
    &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34; /&gt;
    &lt;title&gt;Register - FastAPI Chat App&lt;/title&gt;
    &lt;link
      rel=&#34;icon&#34;
      href=&#34;data:image/svg+xml,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; viewBox=&#39;0 0 100 100&#39;&gt;&lt;text y=&#39;.9em&#39; font-size=&#39;90&#39;&gt;üí¨&lt;/text&gt;&lt;/svg&gt;&#34;
    /&gt;
    &lt;link rel=&#34;stylesheet&#34; href=&#34;/static/css/base.css&#34; /&gt;
    &lt;link rel=&#34;stylesheet&#34; href=&#34;/static/css/app.css&#34; /&gt;
  &lt;/head&gt;
  &lt;body&gt;
&lt;div class=&#34;auth-container&#34;&gt;
  &lt;div class=&#34;auth-form&#34;&gt;
    &lt;h2&gt;Register&lt;/h2&gt;
    &lt;div class=&#34;form-group&#34;&gt;
      &lt;label for=&#34;username&#34;&gt;Username:&lt;/label&gt;
      &lt;input type=&#34;text&#34; id=&#34;username&#34; placeholder=&#34;Enter your username&#34; /&gt;
    &lt;/div&gt;
    &lt;div class=&#34;form-group&#34;&gt;
      &lt;label for=&#34;password&#34;&gt;Password:&lt;/label&gt;
      &lt;input type=&#34;password&#34; id=&#34;password&#34; placeholder=&#34;Enter your password&#34; /&gt;
    &lt;/div&gt;
    &lt;div class=&#34;form-group&#34;&gt;
      &lt;label for=&#34;confirmPassword&#34;&gt;Confirm Password:&lt;/label&gt;
      &lt;input type=&#34;password&#34; id=&#34;confirmPassword&#34; placeholder=&#34;Confirm your password&#34; /&gt;
    &lt;/div&gt;
    &lt;button class=&#34;btn btn-primary&#34; onclick=&#34;register()&#34;&gt;Register&lt;/button&gt;
    &lt;p class=&#34;auth-link&#34;&gt;Already have an account? &lt;a href=&#34;/login&#34;&gt;Login&lt;/a&gt;&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;

    &lt;script src=&#34;/static/js/common.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;/static/js/register.js&#34;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
                </div>
                
              </div>
               
              <div class="step-item" data-step-id="9-3">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="9-3">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">9.3</div>
                    <div class="step-title-section">
                      <div class="step-title">Chat Interface Template</div>
                      
                      <div class="step-file">üìÅ templates/chat.html</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Now let's create our main chat interface HTML template. This template will provide the structure for our modern chat application with a beautiful layout that includes the chat area, message input, and sidebar for online users. I'll show you how to structure the HTML for optimal user experience, including proper semantic markup, accessibility considerations, and integration points for our CSS and JavaScript. This template will be rendered by our FastAPI application and will serve as the main interface for our chat functionality.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="9-3">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="9-3">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-markup"
                  ><code class="language-markup">&lt;!DOCTYPE html&gt;
&lt;html lang=&#34;en&#34;&gt;
  &lt;head&gt;
    &lt;meta charset=&#34;UTF-8&#34; /&gt;
    &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34; /&gt;
    &lt;title&gt;Chat - FastAPI Chat App&lt;/title&gt;
    &lt;link
      rel=&#34;icon&#34;
      href=&#34;data:image/svg+xml,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; viewBox=&#39;0 0 100 100&#39;&gt;&lt;text y=&#39;.9em&#39; font-size=&#39;90&#39;&gt;üí¨&lt;/text&gt;&lt;/svg&gt;&#34;
    /&gt;
    &lt;link rel=&#34;stylesheet&#34; href=&#34;/static/css/base.css&#34; /&gt;
    &lt;link rel=&#34;stylesheet&#34; href=&#34;/static/css/app.css&#34; /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class=&#34;chat-container&#34;&gt;
      &lt;div class=&#34;chat-layout&#34;&gt;
        &lt;div class=&#34;chat-area&#34;&gt;
          &lt;div class=&#34;chat-messages&#34; id=&#34;messages&#34;&gt;
            &lt;!-- Messages will be displayed here --&gt;
          &lt;/div&gt;

          &lt;div class=&#34;chat-input-container&#34;&gt;
            &lt;form class=&#34;chat-input-form&#34; id=&#34;messageForm&#34;&gt;
              &lt;input
                type=&#34;text&#34;
                id=&#34;messageInput&#34;
                class=&#34;chat-input&#34;
                placeholder=&#34;Type your message...&#34;
                autocomplete=&#34;off&#34;
              /&gt;
              &lt;button type=&#34;submit&#34; class=&#34;send-btn&#34;&gt;‚û§&lt;/button&gt;
            &lt;/form&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class=&#34;sidebar&#34;&gt;
          &lt;div class=&#34;sidebar-header&#34;&gt;
            &lt;div class=&#34;user-info&#34;&gt;
              &lt;div class=&#34;logged-in-as&#34;&gt;
                Logged in as: &lt;span id=&#34;current-username&#34;&gt;Loading...&lt;/span&gt;
              &lt;/div&gt;
              &lt;button class=&#34;logout-btn&#34; onclick=&#34;logout()&#34;&gt;Logout&lt;/button&gt;
            &lt;/div&gt;
            &lt;h3 class=&#34;online-users-label&#34;&gt;Online Users&lt;/h3&gt;
          &lt;/div&gt;
          &lt;div id=&#34;online-users&#34; class=&#34;online-users&#34;&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;script src=&#34;/static/js/common.js&#34;&gt;&lt;/script&gt;
    &lt;script src=&#34;/static/js/chat.js&#34;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
                </div>
                
              </div>
              
            </div>
            
            <div class="phase-section">
              <div class="phase-header">
                <div class="phase-number">10</div>
                <h2 class="phase-title">Main Application</h2>
              </div>

               
              <div class="step-item" data-step-id="10-1">
                <div class="tutorial-step-header">
                  <div class="step-edit-controls">
                    <button class="step-edit-btn" data-step-id="10-1">
                      üîí
                    </button>
                  </div>
                  <div class="step-info">
                    <div class="step-number">10.1</div>
                    <div class="step-title-section">
                      <div class="step-title">Main Application Setup</div>
                      
                      <div class="step-file">üìÅ main.py</div>
                      
                    </div>
                    <div class="step-description-container">
                      <div class="step-description">Finally, let's bring everything together in our main FastAPI application file. This is where we'll configure our FastAPI app, set up middleware, mount static files and templates, and include all our routes. I'll show you how to properly configure CORS for cross-origin requests, set up the database initialization, and create the main application structure. This file serves as the entry point for our entire chat application and ties together all the components we've built throughout this tutorial.</div>
                    </div>
                  </div>
                </div>

                
                <div class="code-preview">
                  <div class="code-edit-controls">
                    <button class="code-edit-btn" data-step-id="10-1">
                      üîí
                    </button>
                    <button class="code-copy-btn" data-step-id="10-1">
                      üìã
                    </button>
                  </div>
                   
                  <pre
                    class="line-numbers language-python"
                  ><code class="language-python">from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from fastapi.staticfiles import StaticFiles
from fastapi.responses import FileResponse
from fastapi.templating import Jinja2Templates
from app.routes import router
from app.utils.config import settings
from fastapi.requests import Request
from app.database import init_db

app = FastAPI(
    title=settings.PROJECT_NAME,
    version=settings.VERSION,
    description=settings.DESCRIPTION,
    openapi_url=f&#34;{settings.API_V1_STR}/openapi.json&#34;
)

# Set up CORS middleware
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.parsed_allowed_hosts,
    allow_credentials=True,  # Needed for JWT via cookies
    allow_methods=[&#34;GET&#34;, &#34;POST&#34;],  # Avoid using &#34;*&#34; if not needed
    allow_headers=[&#34;Authorization&#34;, &#34;Content-Type&#34;, &#34;application/json&#34;], 
)

# Initialize database
init_db()

# Set up templates
templates = Jinja2Templates(directory=&#34;templates&#34;)

# Mount static files
app.mount(&#34;/static&#34;, StaticFiles(directory=&#34;static&#34;), name=&#34;static&#34;)

# Include all routes
app.include_router(router, prefix=settings.API_V1_STR)

@app.get(&#34;/&#34;)
async def root(request: Request):
    return templates.TemplateResponse(&#34;login.html&#34;, {&#34;request&#34;: request})

@app.get(&#34;/login&#34;)
async def login_page(request: Request):
    return templates.TemplateResponse(&#34;login.html&#34;, {&#34;request&#34;: request})

@app.get(&#34;/register&#34;)
async def register_page(request: Request):
    return templates.TemplateResponse(&#34;register.html&#34;, {&#34;request&#34;: request})

@app.get(&#34;/chat&#34;)
async def chat_page(request: Request):
    return templates.TemplateResponse(&#34;chat.html&#34;, {&#34;request&#34;: request})

@app.get(&#34;/health&#34;)
async def health_check():
    return {&#34;status&#34;: &#34;healthy&#34;}

if __name__ == &#34;__main__&#34;:
    import uvicorn
    uvicorn.run(app, host=&#34;0.0.0.0&#34;, port=8000)</code></pre>
                </div>
                
              </div>
              
            </div>
            
          </div>
        </div>

        <!-- Flow Tab Content -->
        <div id="flow-tab" class="tab-content">
          <div class="flow-content" id="flow-container">
            

            <!-- Architecture Section -->
            
            <div class="architecture-section">
              <h2>System Architecture</h2>
              <div class="architecture-grid">
                 
                <div class="arch-component">
                  <h3>Client-Side (Browser)</h3>
                   
                  <div>
                    <strong>Authentication</strong>
                    <p>JWT token management and validation</p>
                  </div>
                  
                  <div>
                    <strong>WebSocket Client</strong>
                    <p>Real-time connection management</p>
                  </div>
                  
                  <div>
                    <strong>UI Management</strong>
                    <p>Chat interface and animations</p>
                  </div>
                  
                  <div>
                    <strong>Message Handling</strong>
                    <p>Send/receive message processing</p>
                  </div>
                   
                </div>
                
                <div class="arch-component">
                  <h3>Server-Side (FastAPI)</h3>
                   
                  <div>
                    <strong>Authentication Routes</strong>
                    <p>Register, login, token validation</p>
                  </div>
                  
                  <div>
                    <strong>WebSocket Manager</strong>
                    <p>Connection tracking and broadcasting</p>
                  </div>
                  
                  <div>
                    <strong>Security Middleware</strong>
                    <p>JWT verification and CORS</p>
                  </div>
                  
                  <div>
                    <strong>Message Processing</strong>
                    <p>Message validation and routing</p>
                  </div>
                   
                </div>
                
                <div class="arch-component">
                  <h3>Database (SQLite)</h3>
                   
                  <div>
                    <strong>User Table</strong>
                    <p>Stores user accounts and hashed passwords</p>
                  </div>
                  
                  <div>
                    <strong>Session Management</strong>
                    <p>User authentication state</p>
                  </div>
                  
                  <div>
                    <strong>Data Persistence</strong>
                    <p>User registration and profile data</p>
                  </div>
                   
                </div>
                 
              </div>
            </div>
            

            <!-- Legend Section -->
            
            <div class="legend-section">
              <h2>Flow Legend</h2>
              <div class="legend-grid">
                
                <div class="legend-item">
                  <div class="legend-icon">
                    üîµ 
                  </div>
                  <div class="legend-text">Normal Step</div>
                </div>
                
                <div class="legend-item">
                  <div class="legend-icon">
                    üü° 
                  </div>
                  <div class="legend-text">Decision Point</div>
                </div>
                
                <div class="legend-item">
                  <div class="legend-icon">
                    üü¢ 
                  </div>
                  <div class="legend-text">Success/Completion</div>
                </div>
                
                <div class="legend-item">
                  <div class="legend-icon">
                    üü£ 
                  </div>
                  <div class="legend-text">Database Operation</div>
                </div>
                
                <div class="legend-item">
                  <div class="legend-icon">
                    üî¥ 
                  </div>
                  <div class="legend-text">Security Operation</div>
                </div>
                
              </div>
            </div>
            

            <!-- Flow Diagram -->
            <div class="phases-section">
              <h2>Application Flow</h2>
              <div class="phases-container">
                
                <div class="phase" data-phase="1">
                  <div class="phase-header">
                    <h3>1. User Registration Process</h3>
                  </div>
                  <div class="steps-container">
                    
                    <div
                      class="step normal-point"
                      data-step="1"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">1</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">User Visits Registration Page</div>
                            <div class="step-description">User navigates to /register endpoint</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              main.py ‚Üí register_page()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="2"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">2</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">User Fills Registration Form</div>
                            <div class="step-description">Username and password input</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              register.html template
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="3"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">3</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">JavaScript Validates Form</div>
                            <div class="step-description">Client-side validation (required fields, password 4+ chars)</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/register.js ‚Üí register()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="4"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">4</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Send Registration Request</div>
                            <div class="step-description">POST /api/v1/auth/register with user data</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/register.js ‚Üí fetch()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step database-point"
                      data-step="5"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">5</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Check Username Availability</div>
                            <div class="step-description">Query database for existing username</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/routes.py ‚Üí get_user_by_username()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step decision-point"
                      data-step="6"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">6</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Username Available?</div>
                            <div class="step-description">Check if username already exists</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/routes.py ‚Üí validation logic
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step security-point"
                      data-step="7"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">7</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Hash Password with bcrypt</div>
                            <div class="step-description">Convert plain password to secure hash</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/auth.py ‚Üí get_password_hash()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step database-point"
                      data-step="8"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">8</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Save User to Database</div>
                            <div class="step-description">Insert new user record with hashed password</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/database.py ‚Üí create_user()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step success-point"
                      data-step="9"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">9</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Registration Successful</div>
                            <div class="step-description">Return user data (without password)</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/routes.py ‚Üí register() ‚Üí response
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="10"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">10</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Redirect to Login Page</div>
                            <div class="step-description">User can now login with new credentials</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/register.js ‚Üí redirectTo('/login')
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                  </div>
                </div>
                
                <div class="phase" data-phase="2">
                  <div class="phase-header">
                    <h3>2. User Login & JWT Token Generation</h3>
                  </div>
                  <div class="steps-container">
                    
                    <div
                      class="step normal-point"
                      data-step="1"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">1</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">User Visits Login Page</div>
                            <div class="step-description">User navigates to /login endpoint</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              main.py ‚Üí login_page()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="2"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">2</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">User Enters Credentials</div>
                            <div class="step-description">Username and password input</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              login.html template
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="3"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">3</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Send Login Request</div>
                            <div class="step-description">POST /api/v1/auth/login with form data</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/login.js ‚Üí login()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step database-point"
                      data-step="4"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">4</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Query Database for User</div>
                            <div class="step-description">Find user by username</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/routes.py ‚Üí get_user_by_username()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step decision-point"
                      data-step="5"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">5</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">User Exists?</div>
                            <div class="step-description">Check if username is found</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/routes.py ‚Üí validation logic
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step security-point"
                      data-step="6"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">6</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Verify Password Hash</div>
                            <div class="step-description">Compare input password with stored hash</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/auth.py ‚Üí verify_password()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step decision-point"
                      data-step="7"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">7</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Password Correct?</div>
                            <div class="step-description">bcrypt verification result</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/routes.py ‚Üí validation logic
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step security-point"
                      data-step="8"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">8</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Generate JWT Token</div>
                            <div class="step-description">Create access token with user ID and expiration</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/auth.py ‚Üí create_access_token()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step success-point"
                      data-step="9"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">9</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Return JWT Token</div>
                            <div class="step-description">Send token to client</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/routes.py ‚Üí login() ‚Üí response
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="10"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">10</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Store Token in localStorage</div>
                            <div class="step-description">Client saves token for future requests</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/login.js ‚Üí setToken()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="11"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">11</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Redirect to Chat Page</div>
                            <div class="step-description">User is now authenticated and ready to chat</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/login.js ‚Üí redirectTo('/chat')
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                  </div>
                </div>
                
                <div class="phase" data-phase="3">
                  <div class="phase-header">
                    <h3>3. Chat Page Initialization</h3>
                  </div>
                  <div class="steps-container">
                    
                    <div
                      class="step normal-point"
                      data-step="1"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">1</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">User Visits Chat Page</div>
                            <div class="step-description">Navigate to /chat endpoint</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              main.py ‚Üí chat_page()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="2"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">2</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">JavaScript Checks Authentication</div>
                            <div class="step-description">Verify JWT token exists in localStorage</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/chat.js ‚Üí initializeChat()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step decision-point"
                      data-step="3"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">3</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Token Exists?</div>
                            <div class="step-description">Check if user is logged in</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/common.js ‚Üí isAuthenticated()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="4"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">4</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Get Current User Info</div>
                            <div class="step-description">GET /api/v1/auth/me with JWT token</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/chat.js ‚Üí apiRequest('/auth/me')
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step security-point"
                      data-step="5"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">5</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Server Validates JWT Token</div>
                            <div class="step-description">Decode and verify token signature</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/auth.py ‚Üí verify_token()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step database-point"
                      data-step="6"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">6</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Fetch User from Database</div>
                            <div class="step-description">Get user details by ID from token</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/database.py ‚Üí get_user()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="7"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">7</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Update UI with User Info</div>
                            <div class="step-description">Display username in sidebar</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/chat.js ‚Üí update username display
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step success-point"
                      data-step="8"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">8</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Initialize WebSocket Connection</div>
                            <div class="step-description">Ready to establish real-time connection</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/chat.js ‚Üí connectWebSocket()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                  </div>
                </div>
                
                <div class="phase" data-phase="4">
                  <div class="phase-header">
                    <h3>4. WebSocket Connection & Chat</h3>
                  </div>
                  <div class="steps-container">
                    
                    <div
                      class="step normal-point"
                      data-step="1"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">1</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Create WebSocket Connection</div>
                            <div class="step-description">ws://localhost:8000/api/v1/chat/ws/{token}</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/chat.js ‚Üí new WebSocket()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="2"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">2</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Server Accepts Connection</div>
                            <div class="step-description">WebSocket handshake completed</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/routes.py ‚Üí websocket_endpoint()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step security-point"
                      data-step="3"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">3</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Server Validates Token</div>
                            <div class="step-description">Verify JWT token from URL</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/auth.py ‚Üí verify_token()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step decision-point"
                      data-step="4"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">4</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Token Valid?</div>
                            <div class="step-description">Check authentication status</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/routes.py ‚Üí websocket_endpoint() ‚Üí validation
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="5"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">5</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Add User to Connection Manager</div>
                            <div class="step-description">Store WebSocket connection</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/utils/websocket_manager.py ‚Üí connect()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="6"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">6</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Broadcast User Joined Animation</div>
                            <div class="step-description">Notify all users about new connection</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/utils/websocket_manager.py ‚Üí broadcast_message()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="7"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">7</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Request Online Users List</div>
                            <div class="step-description">Get current online users</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/chat.js ‚Üí loadOnlineUsers()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step success-point"
                      data-step="8"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">8</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Connection Established ‚úì</div>
                            <div class="step-description">Ready for real-time messaging</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/chat.js ‚Üí ws.onopen
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                  </div>
                </div>
                
                <div class="phase" data-phase="5">
                  <div class="phase-header">
                    <h3>5. Real-Time Message Flow</h3>
                  </div>
                  <div class="steps-container">
                    
                    <div
                      class="step normal-point"
                      data-step="1"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">1</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">User Types Message</div>
                            <div class="step-description">Input text in chat interface</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              chat.html ‚Üí message input field
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="2"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">2</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">User Sends Message</div>
                            <div class="step-description">Click send or press Enter</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/chat.js ‚Üí message form submit
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="3"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">3</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Create Message Object</div>
                            <div class="step-description">Format with type, content, timestamp</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/chat.js ‚Üí create message JSON
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="4"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">4</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Send via WebSocket</div>
                            <div class="step-description">Transmit message to server</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/chat.js ‚Üí ws.send()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="5"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">5</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Server Processes Message</div>
                            <div class="step-description">Validate and format message</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/utils/websocket_manager.py ‚Üí handle_websocket_message()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="6"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">6</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Broadcast to All Users</div>
                            <div class="step-description">Send message to all connected clients</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge server">
                              SERVER
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              app/utils/websocket_manager.py ‚Üí broadcast_message()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="7"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">7</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Each Client Receives Message</div>
                            <div class="step-description">WebSocket message event triggered</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/chat.js ‚Üí ws.onmessage
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step normal-point"
                      data-step="8"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">8</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">JavaScript Processes Message</div>
                            <div class="step-description">Parse and determine message type</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/chat.js ‚Üí handleWebSocketMessage()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div
                      class="step success-point"
                      data-step="9"
                      tabindex="0"
                    >
                      <div class="step-header">
                        <div class="step-number">9</div>
                        <div class="step-content">
                          <div class="step-text-container">
                            <div class="step-title">Display Message in Chat</div>
                            <div class="step-description">Add message to chat interface</div>
                          </div>
                          <div class="step-location">
                            <div class="location-badge client">
                              CLIENT
                            </div>
                            <div class="location-file">
                              <span class="file-icon">üìÅ</span>
                              static/js/chat.js ‚Üí addMessage()
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                  </div>
                </div>
                
              </div>
            </div>
            
          </div>
        </div>
      </div>
    </div>

    <div class="toc-indicator" id="tocIndicator">
      <div class="toc-progress">
        <div class="toc-progress-bar" id="tocProgressBar" style="width: 0%"></div>
      </div>
      <div class="toc-content">
        <div class="toc-header">Currently Viewing:</div>
        <div class="toc-current-step">
          <div class="toc-step-number" id="tocStepNumber"></div>
          <div class="toc-step-title" id="tocStepTitle">Loading...</div>
          <div class="toc-step-file" id="tocStepFile">‚Äì</div>
        </div>
      </div>
    </div>

    <!-- Prism Core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
    />

    <!-- Line numbers plugin - MUST come after Prism core -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>

    <!-- Supported languages -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>

    <script>
      // Make tutorial data available globally
      window.tutorialData = {"current_structure": {"description": "Modern project structure with simplified layout", "directories": {"app/": "Main application package", "app/utils/": "Utility modules (config.py, websocket_manager.py)", "static/": "Static assets (CSS, JS)", "templates/": "HTML templates", "tests/": "Test files"}}, "deployment_notes": {"cors_configuration": "Configurable allowed origins", "database_migration": "Automatic table creation with SQLAlchemy", "environment_variables": "All configuration via .env file", "production_considerations": "Change SECRET_KEY, use HTTPS, configure proper CORS", "static_files": "Properly mounted and served by FastAPI"}, "description": "Welcome to this comprehensive tutorial where we\u0027ll build a modern real-time chat application from scratch. We\u0027ll be using FastAPI for our backend, WebSockets for real-time communication, SQLAlchemy for database management, and create a beautiful dark-themed UI with glass morphism effects. This is a complete, production-ready chat application that you can deploy and use immediately.", "environment_setup": {"authentication": "JWT with bcrypt password hashing", "database": "SQLite (configurable to PostgreSQL)", "deployment": "Production-ready with environment configuration", "frontend": "Vanilla JavaScript with modern CSS", "python_version": "3.8+", "real_time": "WebSocket connections with connection management"}, "key_features": ["Modern Authentication: JWT-based login/register with secure password hashing (4-24 chars)", "Real-time Chat: WebSocket-powered instant messaging with animations", "Live Online Users: Real-time user presence with join/leave animations", "Glass Morphism UI: Beautiful dark theme with modern design effects", "Secure Password Handling: bcrypt hashing with salt rounds", "Token-based Security: JWT tokens with configurable expiration", "Responsive Design: Mobile-friendly interface with custom scrollbars", "User Join Animations: Smooth blue glow effects for new users", "Modern CSS: Custom properties, gradients, and backdrop filters", "Clean Architecture: Separated concerns with proper dependency injection"], "phases": [{"phase": 1, "steps": [{"code_snippet": "import secrets\nimport os\n\n# --- Secret Key Generation ---\n\ndef generate_secret_key():\n    \"\"\"Generate a secure 32-byte hex token for SECRET_KEY.\"\"\"\n    return secrets.token_hex(32)\n\n\n# --- Project Structure Creation ---\ndirs = [\n    \"app\",\n    \"app/utils\",\n    \"static\",\n    \"static/css\",\n    \"static/js\",\n    \"templates\"\n]\n\nfiles = [\n    \"main.py\",\n    \"requirements.txt\",\n    \"app/__init__.py\",\n    \"app/utils/__init__.py\",\n    \"app/utils/config.py\",\n    \"app/utils/websocket_manager.py\",\n    \"app/schemas.py\",\n    \"app/auth.py\",\n    \"app/database.py\",\n    \"app/routes.py\",\n    \"static/css/base.css\",\n    \"static/css/app.css\",\n    \"static/js/common.js\",\n    \"static/js/login.js\",\n    \"static/js/register.js\",\n    \"static/js/chat.js\",\n    \"templates/login.html\",\n    \"templates/register.html\",\n    \"templates/chat.html\",\n]\n\n\ndef touch(path):\n    if not os.path.exists(path):\n        with open(path, \"w\", encoding=\"utf-8\") as f:\n            pass\n\n# --- .env File Generation ---\n\ndef write_env_file(secret_key):\n    env_content = f\"\"\"PROJECT_NAME=FastAPI Chat App\nVERSION=\nDESCRIPTION=\nAPI_V1_STR=\nSECRET_KEY={secret_key}\nALGORITHM=HS256\nACCESS_TOKEN_EXPIRE_MINUTES=\nALLOWED_HOSTS=\nDATABASE_URL=\n\"\"\"\n    with open(\".env\", \"w\", encoding=\"utf-8\") as f:\n        f.write(env_content)\n\n\ndef write_requirements_file():\n    \"\"\"Write the minimal requirements.txt with only used packages.\"\"\"\n    requirements_content = \"\"\"fastapi==0.104.1\nuvicorn[standard]==0.24.0\nsqlalchemy==2.0.23\npython-multipart==0.0.6\npython-jose[cryptography]==3.3.0\npasslib[bcrypt]==1.7.4\npython-dotenv==1.0.0\njinja2==3.1.2\nwebsockets==12.0\n\"\"\"\n    with open(\"requirements.txt\", \"w\", encoding=\"utf-8\") as f:\n        f.write(requirements_content)\n\n\nif __name__ == \"__main__\":\n    # Create directories and files\n    for d in dirs:\n        os.makedirs(d, exist_ok=True)\n    for fpath in files:\n        touch(fpath)\n    print(\"Project structure created.\")\n\n    # Generate and write .env\n    secret_key = generate_secret_key()\n    write_env_file(secret_key)\n    print(\".env file generated with a secure SECRET_KEY.\")\n\n    # Write requirements.txt\n    write_requirements_file()\n    print(\"requirements.txt generated with minimal dependencies.\")", "description": "Before we start building our chat application, let\u0027s set up the project structure and generate the necessary files. This setup script will create all the directories and files we need, generate a secure secret key for our application, and create a basic .env file with the required configuration variables. This ensures we have a clean, organized project structure from the beginning and eliminates the need to manually create each file and directory.", "file": "setup.py", "title": "Project Structure Setup"}, {"code_snippet": "fastapi==0.104.1\nuvicorn[standard]==0.24.0\nsqlalchemy==2.0.23\npython-multipart==0.0.6\npython-jose[cryptography]==3.3.0\npasslib[bcrypt]==1.7.4\npython-dotenv==1.0.0\njinja2==3.1.2\nwebsockets==12.0", "description": "Now let\u0027s set up our project dependencies. Since our setup script has already created a basic requirements.txt file, we\u0027ll enhance it with all the packages we need for our chat application. This includes FastAPI for our web framework, uvicorn for the ASGI server, SQLAlchemy for database operations, and several other essential packages for authentication, WebSockets, and UI templating. I\u0027ll show you exactly which versions to use for optimal compatibility.", "file": "requirements.txt", "title": "Dependencies Configuration"}, {"code_snippet": "from pydantic_settings import BaseSettings\nfrom typing import List, Optional\nimport os\n\n\nclass Settings(BaseSettings):\n    # Basic app settings\n    PROJECT_NAME: str\n    VERSION: str\n    DESCRIPTION: str\n    API_V1_STR: str\n\n    # Security\n    SECRET_KEY: str\n    ALGORITHM: str\n    ACCESS_TOKEN_EXPIRE_MINUTES: int\n    ALLOWED_HOSTS: str\n\n    # Database\n    DATABASE_URL: str\n\n    @property\n    def parsed_allowed_hosts(self) -\u003e List[str]:\n        return [host.strip() for host in self.ALLOWED_HOSTS.split(\",\")]\n\n    class Config:\n        env_file = \".env\"\n        case_sensitive = True\n\n\nsettings = Settings()\n", "description": "Now we\u0027ll set up our configuration management system using Pydantic. This is a crucial step that will allow us to manage all our application settings in a type-safe way. We\u0027ll create a Settings class that inherits from BaseSettings, which automatically reads from environment variables. This approach is much more robust than hardcoding values and makes our application deployment-ready. You\u0027ll see how we define all the necessary configuration fields and add a helper method to parse allowed hosts.", "file": "app/utils/config.py", "title": "Configuration Management"}, {"code_snippet": "PROJECT_NAME=FastAPI Chat App\nVERSION=1.0.0\nDESCRIPTION=A real-time chat application with WebSocket support\nAPI_V1_STR=/api/v1\nSECRET_KEY=your-super-secret-key-change-this-in-production\nALGORITHM=HS256\nACCESS_TOKEN_EXPIRE_MINUTES=30\nALLOWED_HOSTS=http://localhost:8000,http://127.0.0.1:8000\nDATABASE_URL=sqlite:///./app.db", "description": "With our Settings class in place, we now need to create our environment file. This .env file will contain all the configuration values that our application needs to run. I\u0027ll show you how to set up each variable properly, including the project metadata, security settings, database connection, and environment-specific configurations. This is where you\u0027ll customize the application for your specific needs, and I\u0027ll explain what each setting does and why it\u0027s important.", "file": ".env", "title": "Environment Configuration"}], "title": "Project Setup \u0026 Configuration"}, {"phase": 2, "steps": [{"code_snippet": "from sqlalchemy import create_engine\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy.orm import sessionmaker\nfrom app.utils.config import settings\n\n# Database setup\nSQLALCHEMY_DATABASE_URL = settings.DATABASE_URL\nengine = create_engine(SQLALCHEMY_DATABASE_URL)\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)\nBase = declarative_base()\n\n# Database dependency\ndef get_db():\n    db = SessionLocal()\n    try:\n        yield db\n    finally:\n        db.close()\n\n# Database initialization\ndef init_db():\n    Base.metadata.create_all(bind=engine)", "description": "Now let\u0027s set up our database layer using SQLAlchemy. This is where we\u0027ll create the database engine, session factory, and base class for our models. I\u0027ll show you how to configure the database connection using our settings, create a session maker for database operations, and set up a dependency function that will handle database sessions throughout our application. This foundation will allow us to perform all our database operations safely and efficiently.", "file": "app/database.py", "title": "Database Setup"}, {"code_snippet": "from sqlalchemy import Column, Integer, String, DateTime\nfrom sqlalchemy.sql import func\nfrom app.database import Base\n\nclass User(Base):\n    __tablename__ = \"users\"\n\n    id = Column(Integer, primary_key=True, index=True)\n    username = Column(String, unique=True, index=True, nullable=False)\n    hashed_password = Column(String, nullable=False)\n    created_at = Column(DateTime(timezone=True), server_default=func.now())", "description": "With our database setup complete, we\u0027ll now create our User model. This SQLAlchemy model will define the structure of our users table, including fields for username, password hash, and timestamps. I\u0027ll show you how to use SQLAlchemy\u0027s Column types, set up proper constraints like unique usernames, and add automatic timestamp handling. This model will be the foundation for our authentication system and user management features.", "file": "app/database.py", "title": "User Model"}, {"code_snippet": "from sqlalchemy.orm import Session\nfrom app.models import User\n\ndef get_user(db: Session, user_id: int):\n    return db.query(User).filter(User.id == user_id).first()\n\ndef get_user_by_username(db: Session, username: str):\n    return db.query(User).filter(User.username == username).first()\n\ndef get_users(db: Session, skip: int = 0, limit: int = 100):\n    return db.query(User).offset(skip).limit(limit).all()\n\ndef create_user(db: Session, username: str, hashed_password: str):\n    db_user = User(username=username, hashed_password=hashed_password)\n    db.add(db_user)\n    db.commit()\n    db.refresh(db_user)\n    return db_user", "description": "Now we\u0027ll create our CRUD operations module. This file will contain all the database functions we need to interact with our User model. I\u0027ll show you how to implement functions for creating users, retrieving users by ID or username, and listing users with pagination. These functions will be used throughout our application for user registration, authentication, and user management. You\u0027ll see how to properly handle database sessions and implement common database patterns.", "file": "app/database.py", "title": "CRUD Operations"}], "title": "Database \u0026 Models"}, {"phase": 3, "steps": [{"code_snippet": "from pydantic import BaseModel, Field, field_validator, EmailStr, StringConstraints, ConfigDict\nfrom typing import Optional, List, Annotated, Literal\nfrom datetime import datetime, timezone\nfrom enum import Enum\n\n\nclass MessageType(str, Enum):\n    \"\"\"WebSocket message types\"\"\"\n    MESSAGE = \"message\"\n    GET_ONLINE_USERS = \"get_online_users\"\n    USER_JOINED_ANIMATION = \"user_joined_animation\"\n    ONLINE_USERS = \"online_users\"\n    ERROR = \"error\"\n\n\nclass UserBase(BaseModel):\n    username: Annotated[str, StringConstraints(min_length=3, max_length=16, strip_whitespace=True)] = Field(\n        ...,\n        description=\"Username must be 3-16 characters long\",\n        example=\"john_doe\"\n    )\n\n    @field_validator(\u0027username\u0027)\n    @classmethod\n    def validate_username(cls, v):\n        return v.lower()  # Normalize to lowercase\n\n\nclass UserCreate(UserBase):\n    password: Annotated[str, StringConstraints(min_length=4, max_length=24)] = Field(\n        ...,\n        description=\"Password must be 4-24 characters long\",\n        example=\"pass123\"\n    )\n\n\nclass User(UserBase):\n    \"\"\"User model for API responses (excludes sensitive data)\"\"\"\n    id: int = Field(..., description=\"Unique user identifier\")\n    created_at: datetime = Field(..., description=\"Account creation timestamp\")\n\n    model_config = ConfigDict(\n        frozen=True,\n        from_attributes=True,\n        json_encoders={datetime: lambda v: v.isoformat()}\n    )\n\n# Token schemas\n\n\nclass Token(BaseModel):\n    access_token: str = Field(..., description=\"JWT access token\")\n    token_type: str = Field(default=\"bearer\", description=\"Token type\")\n    expires_in: Optional[int] = Field(\n        None, description=\"Token expiration time in seconds\")\n\n    model_config = ConfigDict(frozen=True)\n\n# WebSocket message schemas\n\n\nclass WebSocketMessage(BaseModel):\n    \"\"\"Base WebSocket message\"\"\"\n    type: MessageType = Field(..., description=\"Message type\")\n    timestamp: Optional[datetime] = Field(\n        default_factory=lambda: datetime.now(timezone.utc), description=\"Message timestamp\")\n\n    model_config = ConfigDict(\n        frozen=True,\n        json_encoders={datetime: lambda v: v.isoformat()}\n    )\n\n\nclass ChatMessage(WebSocketMessage):\n    \"\"\"Chat message for WebSocket\"\"\"\n    type: Literal[MessageType.MESSAGE] = Field(\n        default=MessageType.MESSAGE, description=\"Message type\")\n    content: Annotated[str, StringConstraints(min_length=1, max_length=1000, strip_whitespace=True)] = Field(\n        ..., description=\"Message content (1-1000 characters)\", example=\"Hello, how are you?\"\n    )\n    user_id: int = Field(..., description=\"Sender user ID\")\n    username: str = Field(..., description=\"Sender username\")\n\n\nclass UserJoinMessage(WebSocketMessage):\n    \"\"\"User join notification\"\"\"\n    type: Literal[MessageType.USER_JOINED_ANIMATION] = Field(\n        default=MessageType.USER_JOINED_ANIMATION, description=\"Message type\")\n    user_id: int = Field(..., description=\"User ID\")\n    username: str = Field(..., description=\"Username\")\n\n\nclass OnlineUser(BaseModel):\n    \"\"\"Individual online user\"\"\"\n    user_id: int = Field(..., description=\"User ID\")\n    username: str = Field(..., description=\"Username\")\n\n    model_config = ConfigDict(frozen=True)\n\n\nclass OnlineUsersMessage(WebSocketMessage):\n    \"\"\"Online users list\"\"\"\n    type: Literal[MessageType.ONLINE_USERS] = Field(\n        default=MessageType.ONLINE_USERS, description=\"Message type\")\n    users: List[OnlineUser] = Field(..., description=\"List of online users\")\n\n\nclass ErrorMessage(WebSocketMessage):\n    \"\"\"Error message\"\"\"\n    type: Literal[MessageType.ERROR] = Field(\n        default=MessageType.ERROR, description=\"Message type\")\n    message: str = Field(..., description=\"Error message\")\n", "description": "Now we\u0027ll create our Pydantic schemas for data validation and serialization. These schemas will define the structure of our API requests and responses, ensuring type safety and proper validation. We\u0027ll create schemas for user registration, authentication, and WebSocket messages. I\u0027ll show you how to use Pydantic\u0027s validation features, including custom validators for usernames and passwords, and how to handle different data types properly.", "file": "app/schemas.py", "title": "Data Validation Schemas"}], "title": "Pydantic Schemas"}, {"phase": 4, "steps": [{"code_snippet": "from datetime import datetime, timedelta\nfrom typing import Any, Union, Optional\nfrom fastapi import Depends, HTTPException, status\nfrom fastapi.security import HTTPBearer, HTTPAuthorizationCredentials\nfrom jose import jwt, JWTError\nfrom passlib.context import CryptContext\nfrom sqlalchemy.orm import Session\nfrom app.utils.config import settings\nfrom app.database import get_db, get_user\n\n\n# Password hashing\npwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")\n\ndef verify_password(plain_password: str, hashed_password: str) -\u003e bool:\n    return pwd_context.verify(plain_password, hashed_password)\n\ndef get_password_hash(password: str) -\u003e str:\n    return pwd_context.hash(password)\n\n# JWT token functions\ndef create_access_token(\n    subject: Union[str, Any], expires_delta: timedelta = None\n) -\u003e str:\n    if expires_delta:\n        expire = datetime.utcnow() + expires_delta\n    else:\n        expire = datetime.utcnow() + timedelta(\n            minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES\n        )\n    to_encode = {\"exp\": expire, \"sub\": str(subject)}\n    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)\n    return encoded_jwt\n\ndef verify_token(token: str, db: Session) -\u003e Optional[Any]:\n    \"\"\"Verify JWT token and return user\"\"\"\n    try:\n        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])\n        user_id: str = payload.get(\"sub\")\n        if user_id is None:\n            return None\n    except JWTError:\n        return None\n    \n    user = get_user(db, user_id=int(user_id))\n    return user\n\n# Dependencies\nsecurity = HTTPBearer()\n\ndef get_current_user(\n    credentials: HTTPAuthorizationCredentials = Depends(security),\n    db: Session = Depends(get_db)\n):\n    credentials_exception = HTTPException(\n        status_code=status.HTTP_401_UNAUTHORIZED,\n        detail=\"Could not validate credentials\",\n        headers={\"WWW-Authenticate\": \"Bearer\"},\n    )\n    \n    user = verify_token(credentials.credentials, db)\n    if user is None:\n        raise credentials_exception\n    return user\n\ndef get_current_active_user(current_user = Depends(get_current_user)):\n    return current_user", "description": "Security is crucial for any chat application, so let\u0027s implement secure password handling using bcrypt. This module will provide functions for hashing passwords and verifying them during login. I\u0027ll show you how to use the passlib library with bcrypt, which is one of the most secure hashing algorithms available. We\u0027ll set up the password context with proper configuration and create two main functions: one for hashing new passwords and another for verifying existing ones.", "file": "app/auth.py", "title": "Password Security"}], "title": "Authentication System"}, {"phase": 5, "steps": [{"code_snippet": "from fastapi import WebSocket, WebSocketDisconnect\nfrom typing import Dict, List\nimport json\nfrom datetime import datetime\nfrom app.database import User\nfrom app.schemas import ChatMessage, UserJoinMessage, OnlineUsersMessage, ErrorMessage\n\n\nclass ConnectionManager:\n    def __init__(self):\n        # Store active connections: {user_id: WebSocket}\n        self.active_connections: Dict[int, WebSocket] = {}\n        self.user_info: Dict[int, dict] = {}\n\n    async def connect(self, websocket: WebSocket, user: User):\n        user_id = user.id\n        self.active_connections[user_id] = websocket\n        self.user_info[user_id] = {\n            \"username\": user.username,\n            \"is_online\": True\n        }\n\n        # Send join notification to all other users (for animation effect)\n        await self.broadcast_join_notification(user_id, user.username)\n\n        # Update online users list for all connected users\n        await self.broadcast_online_users_update()\n\n    def disconnect(self, user_id: int):\n        if user_id in self.active_connections:\n            del self.active_connections[user_id]\n        if user_id in self.user_info:\n            del self.user_info[user_id]\n        return None\n\n    async def disconnect_user(self, user_id: int):\n        \"\"\"Disconnect user and update online users list for remaining users\"\"\"\n        self.disconnect(user_id)\n        # Update online users list for all remaining connected users\n        await self.broadcast_online_users_update()\n\n    async def send_personal_message(self, message: dict, user_id: int):\n        \"\"\"Send message to a single user (system messages)\"\"\"\n        if user_id in self.active_connections:\n            try:\n                await self.active_connections[user_id].send_text(json.dumps(message))\n            except:\n                # Connection might be closed\n                pass\n\n    async def broadcast_message(self, message: dict):\n        \"\"\"Send message to all connected users\"\"\"\n        disconnected_users = []\n        for user_id, connection in self.active_connections.items():\n            try:\n                await connection.send_text(json.dumps(message))\n            except:\n                disconnected_users.append(user_id)\n\n        # Clean up disconnected users\n        for user_id in disconnected_users:\n            self.disconnect(user_id)\n\n    async def broadcast_join_notification(self, new_user_id: int, new_username: str):\n        \"\"\"Broadcast join notification to all users except the new user\"\"\"\n        join_message = UserJoinMessage(\n            user_id=new_user_id,\n            username=new_username\n        )\n\n        for user_id in self.active_connections.keys():\n            if user_id != new_user_id:  # Don\u0027t send to the new user\n                await self.send_personal_message(join_message.model_dump(), user_id)\n\n    async def broadcast_online_users_update(self):\n        \"\"\"Broadcast updated online users list to all connected users\"\"\"\n        for user_id in self.active_connections.keys():\n            online_users = self.get_online_users(exclude_user_id=user_id)\n            online_users_message = OnlineUsersMessage(users=online_users)\n            await self.send_personal_message(online_users_message.model_dump(), user_id)\n\n    def get_online_users(self, exclude_user_id: int = None) -\u003e List[dict]:\n        \"\"\"Get list of online users, optionally excluding a specific user\"\"\"\n        return [\n            {\n                \"user_id\": user_id,\n                \"username\": info[\"username\"]\n            }\n            for user_id, info in self.user_info.items()\n            if exclude_user_id is None or user_id != exclude_user_id\n        ]\n\n    async def handle_websocket_message(self, websocket: WebSocket, user_id: int, data: dict):\n        \"\"\"Handle incoming WebSocket messages\"\"\"\n        message_type = data.get(\"type\")\n\n        if message_type == \"message\":\n            try:\n                # Validate message using Pydantic schema\n                chat_message = ChatMessage(\n                    content=data.get(\"content\", \"\"),\n                    user_id=user_id,\n                    username=self.user_info[user_id][\"username\"]\n                )\n\n                # Broadcast validated message\n                await self.broadcast_message(chat_message.model_dump())\n\n            except Exception as e:\n                # Send validation error to the user\n                error_message = ErrorMessage(\n                    message=\"Invalid message format or content too long\")\n                await self.send_personal_message(error_message.model_dump(), user_id)\n\n        elif message_type == \"get_online_users\":\n            online_users = self.get_online_users(exclude_user_id=user_id)\n            print(\n                f\"User {user_id} requested online users. Found: {len(online_users)} users\")\n            online_users_message = OnlineUsersMessage(users=online_users)\n            await self.send_personal_message(online_users_message.model_dump(), user_id)\n\n\n# Global connection manager instance\nmanager = ConnectionManager()\n", "description": "This is where the magic happens! We\u0027ll create our WebSocket connection manager that will handle all real-time communication in our chat application. This class will manage active WebSocket connections, broadcast messages to all connected users, and handle user join/leave events with beautiful animations. I\u0027ll show you how to implement a robust connection manager that can handle multiple users, gracefully manage disconnections, and provide real-time features like online user lists and message broadcasting. This is the core of our real-time chat functionality.", "file": "app/utils/websocket_manager.py", "title": "WebSocket Connection Manager"}], "title": "WebSocket Management"}, {"phase": 6, "steps": [{"code_snippet": "from fastapi import APIRouter, Depends, HTTPException, status, WebSocket, WebSocketDisconnect, Form\nfrom fastapi.security import HTTPBearer, HTTPAuthorizationCredentials\nfrom sqlalchemy.orm import Session\nfrom typing import List\nfrom app.auth import get_current_active_user, create_access_token, verify_password, get_password_hash, verify_token\nfrom app.database import get_db, get_user_by_username, create_user, get_users\nfrom app.schemas import User, UserCreate, Token\nfrom app.utils.websocket_manager import manager\nfrom app.utils.config import settings\n\nrouter = APIRouter()\n\n# HTTP Routes\n\n\n@router.post(\"/auth/register\", response_model=User)\ndef register(user: UserCreate, db: Session = Depends(get_db)):\n    db_user = get_user_by_username(db, username=user.username)\n    if db_user:\n        raise HTTPException(\n            status_code=400, detail=\"Username already registered\")\n\n    hashed_password = get_password_hash(user.password)\n    db_user = create_user(db, username=user.username,\n                          hashed_password=hashed_password)\n    return db_user\n\n\n@router.post(\"/auth/login\", response_model=Token)\ndef login(username: str = Form(...), password: str = Form(...), db: Session = Depends(get_db)):\n    user = get_user_by_username(db, username=username)\n    if not user or not verify_password(password, user.hashed_password):\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Incorrect username or password\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n\n    access_token = create_access_token(subject=user.id)\n    return {\"access_token\": access_token, \"token_type\": \"bearer\"}\n\n\n@router.get(\"/auth/me\", response_model=User)\ndef read_users_me(current_user: User = Depends(get_current_active_user)):\n    return current_user\n\n\n@router.get(\"/users\", response_model=List[User])\ndef read_users(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    users = get_users(db, skip=skip, limit=limit)\n    return users\n\n# WebSocket Routes\n\n\n@router.websocket(\"/chat/ws/{token}\")\nasync def websocket_endpoint(websocket: WebSocket, token: str):\n    await websocket.accept()\n\n    # Verify token and get user\n    db = next(get_db())\n    user = verify_token(token, db)\n    if not user:\n        await websocket.close(code=status.WS_1008_POLICY_VIOLATION)\n        return\n\n    # Add user to WebSocket manager\n    await manager.connect(websocket, user)\n\n    try:\n        while True:\n            data = await websocket.receive_text()\n            import json\n            data_dict = json.loads(data)\n            await manager.handle_websocket_message(websocket, user.id, data_dict)\n    except WebSocketDisconnect:\n        await manager.disconnect_user(user.id)", "description": "Now let\u0027s create our authentication routes. These HTTP endpoints will handle user registration, login, and user profile access. I\u0027ll show you how to implement secure registration with password hashing, login with JWT token generation, and a protected endpoint to get the current user\u0027s information. We\u0027ll use FastAPI\u0027s form handling for login and proper error responses for various scenarios. These routes will be the entry point for users to access our chat application.", "file": "app/routes.py", "title": "Authentication Routes"}], "title": "HTTP \u0026 WebSocket Routes"}, {"phase": 7, "steps": [{"code_snippet": "/* Reset and base styles */\n* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nbody {\n  font-family: \u0027Segoe UI\u0027, Tahoma, Geneva, Verdana, sans-serif;\n  background: linear-gradient(135deg, #303c52 0%, #455c81 100%);\n  min-height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Common form styles */\n.form-group {\n  margin-bottom: 20px;\n}\n\nlabel {\n  display: block;\n  margin-bottom: 8px;\n  color: #e2e8f0;\n  font-weight: 500;\n}\n\ninput {\n  width: 100%;\n  padding: 12px 16px;\n  border: 2px solid #4a5568;\n  border-radius: 10px;\n  font-size: 16px;\n  transition: all 0.3s ease;\n  background: #2d3748;\n  color: #e2e8f0;\n}\n\ninput:focus {\n  outline: none;\n  border-color: #a0aec0;\n  box-shadow: 0 0 0 3px rgba(160, 174, 192, 0.1);\n}\n\nbutton {\n  width: 100%;\n  padding: 14px;\n  background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);\n  color: #1a202c;\n  border: none;\n  border-radius: 10px;\n  font-size: 16px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  margin-bottom: 15px;\n}\n\nbutton:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 10px 20px rgba(160, 174, 192, 0.3);\n}\n\nbutton:active {\n  transform: translateY(0);\n}\n\n/* Responsive design */\n@media (max-width: 768px) {\n  .container {\n    margin: 20px;\n    padding: 30px;\n  }\n}", "description": "Now let\u0027s create the foundation of our beautiful UI with our base CSS file. This will establish our dark theme, typography, and common component styles. I\u0027ll show you how to create a modern, cohesive design system with proper color schemes, typography, and interactive elements. We\u0027ll set up the base styles for buttons, form inputs, and other common components that will be used throughout our application. This creates the foundation for our glass morphism effects and modern chat interface.", "file": "static/css/base.css", "title": "Base CSS Styling"}, {"code_snippet": "/* Auth page specific styles */\n.auth-container {\n  background: rgba(45, 55, 72, 0.95);\n  border-radius: 20px;\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n  padding: 40px;\n  width: 100%;\n  max-width: 400px;\n  backdrop-filter: blur(10px);\n  border: 1px solid rgba(160, 174, 192, 0.2);\n}\n\n.auth-form h2 {\n  text-align: center;\n  color: #e2e8f0;\n  margin-bottom: 30px;\n  font-size: 2.5em;\n  font-weight: 300;\n}\n\n.auth-link {\n  text-align: center;\n  margin-top: 20px;\n  color: #a0aec0;\n}\n\n.auth-link a {\n  color: #a0aec0;\n  text-decoration: none;\n  font-weight: 500;\n  transition: color 0.3s ease;\n}\n\n.auth-link a:hover {\n  color: #e2e8f0;\n}\n\n/* Chat page specific styles */\n.chat-container {\n  background: rgba(26, 32, 44, 0.95);\n  border-radius: 20px;\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n  width: 100%;\n  max-width: 1200px;\n  height: 600px;\n  display: flex;\n  flex-direction: column;\n  backdrop-filter: blur(10px);\n  overflow: hidden;\n}\n\n.logout-btn {\n  background: rgba(239, 68, 68, 0.2);\n  border: 1px solid rgba(239, 68, 68, 0.4);\n  color: #fecaca;\n  padding: 6px 12px;\n  border-radius: 6px;\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  width: auto;\n  margin: 0;\n}\n\n.logout-btn:hover {\n  background: rgba(239, 68, 68, 0.3);\n  border-color: rgba(239, 68, 68, 0.6);\n  color: #fca5a5;\n  transform: none;\n  box-shadow: none;\n}\n\n/* Chat Layout */\n.chat-layout {\n  display: flex;\n  flex: 1;\n  height: 100%;\n}\n\n.chat-area {\n  flex: 2;\n  display: flex;\n  flex-direction: column;\n  border-right: 1px solid #4a5568;\n  border-radius: 0 0 0 20px;\n}\n\n.sidebar {\n  flex: 1;\n  background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);\n  border-left: 1px solid rgba(160, 174, 192, 0.2);\n  position: relative;\n}\n\n.sidebar::before {\n  content: \u0027\u0027;\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 1px;\n  background: linear-gradient(\n    90deg,\n    transparent 0%,\n    rgba(160, 174, 192, 0.3) 50%,\n    transparent 100%\n  );\n}\n\n.sidebar-header {\n  display: flex;\n  flex-direction: column;\n  position: relative;\n  width: 100%;\n  margin: 0;\n}\n\n.user-info {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  background: rgba(70, 80, 99, 0.3);\n  padding: 10px 14px;\n  width: 100%;\n  margin: 0;\n  margin-bottom: 20px;\n}\n\n.logged-in-as {\n  font-size: 13px;\n  color: #a0aec0;\n  font-weight: 500;\n  letter-spacing: 0.3px;\n}\n\n.logged-in-as span {\n  color: #4a90e2;\n  font-weight: 600;\n  text-shadow: 0 0 10px rgba(74, 144, 226, 0.3);\n}\n\n.online-users-label {\n  margin: 0;\n  font-size: 11px;\n  color: #4d5868;\n  font-weight: 400;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n  text-align: right;\n  font-style: italic;\n  font-family: \u0027Script\u0027, sans-serif;\n  padding-right: 8px;\n  padding-bottom: 7px;\n}\n\n.online-users {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  overflow-y: auto;\n  max-height: calc(100vh - 250px);\n  padding-right: 8px;\n  padding-bottom: 40px;\n}\n\n.online-users::-webkit-scrollbar {\n  width: 6px;\n}\n\n.online-users::-webkit-scrollbar-track {\n  background: rgba(26, 32, 44, 0.3);\n  border-radius: 3px;\n}\n\n.online-users::-webkit-scrollbar-thumb {\n  background: rgba(160, 174, 192, 0.3);\n  border-radius: 3px;\n}\n\n.online-users::-webkit-scrollbar-thumb:hover {\n  background: rgba(160, 174, 192, 0.5);\n}\n\n.online-user {\n  padding: 12px 16px;\n  background: rgba(26, 32, 44, 0.8);\n  border: 1px solid rgba(160, 174, 192, 0.15);\n  border-radius: 10px;\n  font-size: 14px;\n  color: #e2e8f0;\n  font-weight: 500;\n  transition: all 0.3s ease;\n  position: relative;\n  backdrop-filter: blur(5px);\n}\n\n.online-user.joining {\n  animation: userJoin 800ms ease-out;\n}\n\n@keyframes userJoin {\n  0% {\n    background: rgba(54, 108, 170, 0.3);\n    border-color: #4a91e27c;\n    box-shadow: 0 0 10px rgba(37, 78, 124, 0.5);\n    opacity: 0.6;\n  }\n  50% {\n    background: rgba(74, 144, 226, 0.2);\n    border-color: #4a90e2;\n    box-shadow: 0 0 15px rgba(53, 106, 167, 0.7);\n    opacity: 0.9;\n  }\n  100% {\n    background: rgba(26, 32, 44, 0.8);\n    border-color: rgba(160, 174, 192, 0.15);\n    box-shadow: none;\n    opacity: 1;\n  }\n}\n\n.chat-messages {\n  flex: 1;\n  overflow-y: auto;\n  padding: 20px;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n\n.message {\n  max-width: 70%;\n  padding: 12px 16px;\n  border-radius: 15px;\n  word-wrap: break-word;\n}\n\n.message.own {\n  align-self: flex-end;\n  background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);\n  color: white;\n}\n\n.message.other {\n  align-self: flex-start;\n  background: rgba(45, 55, 72, 0.8);\n  color: #e2e8f0;\n  border: 1px solid rgba(160, 174, 192, 0.2);\n}\n\n.message-header {\n  font-size: 12px;\n  font-weight: 600;\n  margin-bottom: 4px;\n  opacity: 0.8;\n}\n\n.message-content {\n  font-size: 14px;\n  line-height: 1.4;\n}\n\n.chat-input-container {\n  padding: 20px;\n  border-top: 1px solid #4a5568;\n}\n\n.chat-input-form {\n  display: flex;\n  gap: 10px;\n  align-items: center;\n}\n\n.chat-input {\n  flex: 1;\n  padding: 12px 16px;\n  border: 2px solid #4a5568;\n  border-radius: 25px;\n  background: rgba(26, 32, 44, 0.8);\n  color: #e2e8f0;\n  font-size: 14px;\n  transition: all 0.3s ease;\n}\n\n.chat-input::placeholder {\n  color: #a0aec0;\n}\n\n.chat-input:focus {\n  outline: none;\n  border-color: #4a90e2;\n  box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);\n  background: rgba(45, 55, 72, 0.9);\n}\n\n.send-btn {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);\n  color: white;\n  border: none;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 16px;\n  transition: all 0.3s ease;\n  margin: 0;\n}\n\n.send-btn:hover {\n  transform: scale(1.1);\n  box-shadow: 0 4px 15px rgba(74, 144, 226, 0.4);\n}\n\n.send-btn:active {\n  transform: scale(0.95);\n}", "description": "Now we\u0027ll create the specific styles for our chat application interface. This CSS file will implement the beautiful glass morphism effects, modern chat layout, and smooth animations that make our application stand out. I\u0027ll show you how to create the chat container with proper styling, implement the sidebar for online users, add custom scrollbars, and create smooth animations for user join events. This is where we bring the modern, professional look to our chat application with attention to detail and user experience.", "file": "static/css/app.css", "title": "Chat Interface Styling"}], "title": "Modern UI - CSS Styling"}, {"phase": 8, "steps": [{"code_snippet": "// Common utilities and constants\nconst API_BASE = \u0027http://localhost:8000/api/v1\u0027;\n\n// Utility functions\nfunction showAlert(message, type = \u0027info\u0027) {\n  console.log(`${type.toUpperCase()}: ${message}`);\n  alert(message);\n}\n\nfunction redirectTo(url) {\n  window.location.href = url;\n}\n\n// Check if user is authenticated\nfunction isAuthenticated() {\n  return localStorage.getItem(\u0027token\u0027) !== null;\n}\n\n// Get stored token\nfunction getToken() {\n  return localStorage.getItem(\u0027token\u0027);\n}\n\n// Store token\nfunction storeToken(token) {\n  localStorage.setItem(\u0027token\u0027, token);\n}\n\n// Remove token\nfunction removeToken() {\n  localStorage.removeItem(\u0027token\u0027);\n}\n\n// API request helper\nasync function apiRequest(endpoint, options = {}) {\n  const token = getToken();\n  const defaultHeaders = {\n    \u0027Content-Type\u0027: \u0027application/json\u0027,\n  };\n\n  if (token) {\n    defaultHeaders[\u0027Authorization\u0027] = `Bearer ${token}`;\n  }\n\n  const config = {\n    headers: { ...defaultHeaders, ...options.headers },\n    ...options,\n  };\n\n  try {\n    const response = await fetch(`${API_BASE}${endpoint}`, config);\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(error.detail || \u0027Request failed\u0027);\n    }\n\n    return await response.json();\n  } catch (error) {\n    console.error(\u0027API request error:\u0027, error);\n    throw error;\n  }\n}", "description": "Let\u0027s create our common JavaScript utilities that will be shared across our application. This file will contain helper functions for authentication, API requests, and common UI operations. I\u0027ll show you how to implement token management for local storage, authentication state checking, and a reusable API request function that automatically handles authentication headers. These utilities will make our frontend code cleaner and more maintainable by centralizing common functionality.", "file": "static/js/common.js", "title": "Common JavaScript Utilities"}, {"code_snippet": "// Login functionality\nasync function login() {\n  const username = document.getElementById(\u0027username\u0027).value;\n  const password = document.getElementById(\u0027password\u0027).value;\n\n  if (!username || !password) {\n    showAlert(\u0027Please enter both username and password\u0027);\n    return;\n  }\n\n  try {\n    const response = await fetch(`${API_BASE}/auth/login`, {\n      method: \u0027POST\u0027,\n      headers: {\n        \u0027Content-Type\u0027: \u0027application/x-www-form-urlencoded\u0027,\n      },\n      body: `username=${encodeURIComponent(username)}\u0026password=${encodeURIComponent(password)}`,\n    });\n\n    if (response.ok) {\n      const data = await response.json();\n      storeToken(data.access_token);\n      redirectTo(\u0027/chat\u0027);\n    } else {\n      const error = await response.json();\n      showAlert(error.detail || \u0027Login failed. Please check your credentials.\u0027);\n    }\n  } catch (error) {\n    console.error(\u0027Login error:\u0027, error);\n    showAlert(\u0027Login failed. Please try again.\u0027);\n  }\n}\n\n// Handle Enter key in login form\ndocument.addEventListener(\u0027DOMContentLoaded\u0027, function () {\n  const passwordInput = document.getElementById(\u0027password\u0027);\n  if (passwordInput) {\n    passwordInput.addEventListener(\u0027keypress\u0027, function (event) {\n      if (event.key === \u0027Enter\u0027) {\n        login();\n      }\n    });\n  }\n});", "description": "Now we\u0027ll implement the login functionality. This JavaScript file will handle user authentication, form validation, and token management. I\u0027ll show you how to implement secure login with proper error handling, form data submission, and automatic redirection after successful authentication. We\u0027ll also add keyboard support for better user experience and proper token storage for session management.", "file": "static/js/login.js", "title": "Login Functionality"}, {"code_snippet": "// Registration functionality\nasync function register() {\n  const username = document.getElementById(\u0027username\u0027).value;\n  const password = document.getElementById(\u0027password\u0027).value;\n  const confirmPassword = document.getElementById(\u0027confirmPassword\u0027).value;\n\n  if (!username || !password || !confirmPassword) {\n    showAlert(\u0027Please fill in all fields\u0027);\n    return;\n  }\n\n  if (password !== confirmPassword) {\n    showAlert(\u0027Passwords do not match\u0027);\n    return;\n  }\n\n  if (password.length \u003c 4) {\n    showAlert(\u0027Password must be at least 4 characters long\u0027);\n    return;\n  }\n\n  try {\n    const response = await fetch(`${API_BASE}/auth/register`, {\n      method: \u0027POST\u0027,\n      headers: {\n        \u0027Content-Type\u0027: \u0027application/json\u0027,\n      },\n      body: JSON.stringify({\n        username,\n        password,\n      }),\n    });\n\n    if (response.ok) {\n      showAlert(\u0027Registration successful! Please login.\u0027, \u0027success\u0027);\n      redirectTo(\u0027/login\u0027);\n    } else {\n      const error = await response.json();\n      showAlert(error.detail || \u0027Registration failed\u0027);\n    }\n  } catch (error) {\n    console.error(\u0027Registration error:\u0027, error);\n    showAlert(\u0027Registration failed. Please try again.\u0027);\n  }\n}\n\n// Handle Enter key in register form\ndocument.addEventListener(\u0027DOMContentLoaded\u0027, function () {\n  const confirmPasswordInput = document.getElementById(\u0027confirmPassword\u0027);\n  if (confirmPasswordInput) {\n    confirmPasswordInput.addEventListener(\u0027keypress\u0027, function (event) {\n      if (event.key === \u0027Enter\u0027) {\n        register();\n      }\n    });\n  }\n});", "description": "Now we\u0027ll implement the registration functionality. This JavaScript file will handle user registration with proper validation, password confirmation, and error handling. I\u0027ll show you how to implement client-side validation for password matching and length requirements, secure form submission, and proper user feedback. We\u0027ll also add keyboard support and automatic redirection after successful registration.", "file": "static/js/register.js", "title": "Registration Functionality"}, {"code_snippet": "// Simple Chat functionality\nlet ws = null;\nlet currentUser = null;\n\n// Initialize chat when page loads\ndocument.addEventListener(\u0027DOMContentLoaded\u0027, function () {\n  if (!isAuthenticated()) {\n    redirectTo(\u0027/login\u0027);\n    return;\n  }\n  initializeChat();\n});\n\nasync function initializeChat() {\n  try {\n    currentUser = await apiRequest(\u0027/auth/me\u0027);\n    // Update the current username display\n    const usernameElement = document.getElementById(\u0027current-username\u0027);\n    if (usernameElement) {\n      usernameElement.textContent = currentUser.username;\n    }\n    connectWebSocket();\n  } catch (error) {\n    console.error(\u0027Failed to initialize chat:\u0027, error);\n    removeToken();\n    redirectTo(\u0027/login\u0027);\n  }\n}\n\nfunction connectWebSocket() {\n  const token = getToken();\n  ws = new WebSocket(`ws://localhost:8000/api/v1/chat/ws/${token}`);\n\n  ws.onopen = function () {\n    console.log(\u0027Connected to chat\u0027);\n    loadOnlineUsers();\n  };\n\n  ws.onmessage = function (event) {\n    const data = JSON.parse(event.data);\n    handleWebSocketMessage(data);\n  };\n\n  ws.onclose = function () {\n    console.log(\u0027Disconnected from chat\u0027);\n  };\n\n  ws.onerror = function (error) {\n    console.error(\u0027WebSocket error:\u0027, error);\n  };\n}\n\nfunction handleWebSocketMessage(data) {\n  console.log(\u0027Received WebSocket message:\u0027, data.type, data);\n  switch (data.type) {\n    case \u0027message\u0027:\n      if (data.user_id === currentUser.id) {\n        addMessage(data.content, \u0027You\u0027, \u0027own\u0027);\n      } else {\n        addMessage(data.content, data.username, \u0027other\u0027);\n      }\n      break;\n    case \u0027user_joined_animation\u0027:\n      console.log(\u0027Received join animation for:\u0027, data.username);\n      // Store the username to highlight after online users update\n      window.pendingHighlight = data.username;\n      break;\n    case \u0027online_users\u0027:\n      updateOnlineUsers(data.users);\n      // Check if we need to highlight a new user\n      if (window.pendingHighlight) {\n        setTimeout(() =\u003e {\n          highlightNewUser(window.pendingHighlight);\n          window.pendingHighlight = null;\n        }, 100); // Small delay to ensure DOM is updated\n      }\n      break;\n  }\n}\n\nfunction addMessage(content, username, type) {\n  const messagesContainer = document.getElementById(\u0027messages\u0027);\n  const messageDiv = document.createElement(\u0027div\u0027);\n  messageDiv.className = `message ${type}`;\n\n  const headerDiv = document.createElement(\u0027div\u0027);\n  headerDiv.className = \u0027message-header\u0027;\n  headerDiv.textContent = username;\n\n  const contentDiv = document.createElement(\u0027div\u0027);\n  contentDiv.className = \u0027message-content\u0027;\n  contentDiv.textContent = content;\n\n  messageDiv.appendChild(headerDiv);\n  messageDiv.appendChild(contentDiv);\n\n  messagesContainer.appendChild(messageDiv);\n  messagesContainer.scrollTop = messagesContainer.scrollHeight;\n}\n\nfunction sendMessage() {\n  const messageInput = document.getElementById(\u0027messageInput\u0027);\n  const content = messageInput.value.trim();\n\n  if (content \u0026\u0026 ws \u0026\u0026 ws.readyState === WebSocket.OPEN) {\n    ws.send(\n      JSON.stringify({\n        type: \u0027message\u0027,\n        content: content,\n      })\n    );\n    messageInput.value = \u0027\u0027;\n  }\n}\n\n// Handle form submission\ndocument.addEventListener(\u0027DOMContentLoaded\u0027, function () {\n  const messageForm = document.getElementById(\u0027messageForm\u0027);\n  if (messageForm) {\n    messageForm.addEventListener(\u0027submit\u0027, function (e) {\n      e.preventDefault();\n      sendMessage();\n    });\n  }\n});\n\nfunction loadOnlineUsers() {\n  if (ws \u0026\u0026 ws.readyState === WebSocket.OPEN) {\n    ws.send(\n      JSON.stringify({\n        type: \u0027get_online_users\u0027,\n      })\n    );\n  }\n}\n\nfunction updateOnlineUsers(users) {\n  const onlineUsersContainer = document.getElementById(\u0027online-users\u0027);\n  if (!onlineUsersContainer) return;\n\n  onlineUsersContainer.innerHTML = \u0027\u0027;\n\n    // Filter out the current user from the list\n    const otherUsers = users.filter((user) =\u003e user.id !== currentUser.id);\n\n  otherUsers.forEach((user) =\u003e {\n    const userDiv = document.createElement(\u0027div\u0027);\n    userDiv.className = \u0027online-user\u0027;\n    userDiv.textContent = user.username;\n    userDiv.dataset.username = user.username; // Add data attribute for easy finding\n    onlineUsersContainer.appendChild(userDiv);\n  });\n}\n\nfunction highlightNewUser(username) {\n  console.log(\u0027Highlighting new user:\u0027, username);\n  const onlineUsersContainer = document.getElementById(\u0027online-users\u0027);\n  if (!onlineUsersContainer) {\n    console.log(\u0027Online users container not found\u0027);\n    return;\n  }\n\n  // Find the user element by username\n  const userElements = onlineUsersContainer.querySelectorAll(\u0027.online-user\u0027);\n  console.log(\u0027Found user elements:\u0027, userElements.length);\n  const userElement = Array.from(userElements).find((el) =\u003e el.textContent === username);\n\n  if (userElement) {\n    console.log(\u0027Found user element, adding joining class\u0027);\n    // Add the joining class to trigger the animation\n    userElement.classList.add(\u0027joining\u0027);\n\n    // Remove the class after animation completes\n    setTimeout(() =\u003e {\n      userElement.classList.remove(\u0027joining\u0027);\n      console.log(\u0027Removed joining class\u0027);\n    }, 2000); // Match the animation duration\n  } else {\n    console.log(\u0027User element not found for:\u0027, username);\n  }\n}\n\nfunction logout() {\n  if (ws) {\n    ws.close();\n  }\n  removeToken();\n  redirectTo(\u0027/login\u0027);\n}", "description": "Now we\u0027ll implement the core chat functionality with WebSocket communication. This JavaScript file will handle connecting to our WebSocket endpoint, managing real-time message sending and receiving, and implementing beautiful user join animations. I\u0027ll show you how to establish WebSocket connections with proper authentication, handle different message types, update the online users list in real-time, and create smooth animations when users join the chat. This brings all our backend functionality to life in the frontend.", "file": "static/js/chat.js", "title": "WebSocket Chat Implementation"}], "title": "JavaScript Functionality"}, {"phase": 9, "steps": [{"code_snippet": "\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n  \u003chead\u003e\n    \u003cmeta charset=\"UTF-8\" /\u003e\n    \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /\u003e\n    \u003ctitle\u003eLogin - FastAPI Chat App\u003c/title\u003e\n    \u003clink\n      rel=\"icon\"\n      href=\"data:image/svg+xml,\u003csvg xmlns=\u0027http://www.w3.org/2000/svg\u0027 viewBox=\u00270 0 100 100\u0027\u003e\u003ctext y=\u0027.9em\u0027 font-size=\u002790\u0027\u003e\ud83d\udcac\u003c/text\u003e\u003c/svg\u003e\"\n    /\u003e\n    \u003clink rel=\"stylesheet\" href=\"/static/css/base.css\" /\u003e\n    \u003clink rel=\"stylesheet\" href=\"/static/css/app.css\" /\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n\u003cdiv class=\"auth-container\"\u003e\n  \u003cdiv class=\"auth-form\"\u003e\n    \u003ch2\u003eLogin to Chat\u003c/h2\u003e\n    \u003cdiv class=\"form-group\"\u003e\n      \u003clabel for=\"username\"\u003eUsername:\u003c/label\u003e\n      \u003cinput type=\"text\" id=\"username\" placeholder=\"Enter your username\" /\u003e\n    \u003c/div\u003e\n    \u003cdiv class=\"form-group\"\u003e\n      \u003clabel for=\"password\"\u003ePassword:\u003c/label\u003e\n      \u003cinput type=\"password\" id=\"password\" placeholder=\"Enter your password\" /\u003e\n    \u003c/div\u003e\n    \u003cbutton class=\"btn btn-primary\" onclick=\"login()\"\u003eLogin\u003c/button\u003e\n    \u003cp class=\"auth-link\"\u003eDon\u0027t have an account? \u003ca href=\"/register\"\u003eRegister\u003c/a\u003e\u003c/p\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n\n    \u003cscript src=\"/static/js/common.js\"\u003e\u003c/script\u003e\n\u003cscript src=\"/static/js/login.js\"\u003e\u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e", "description": "Now let\u0027s create our login page template. This HTML template will provide a clean, modern interface for user authentication with proper form structure and styling integration. I\u0027ll show you how to structure the HTML for optimal user experience, including proper semantic markup, accessibility considerations, and integration points for our CSS and JavaScript. This template will be rendered by our FastAPI application and will serve as the entry point for user authentication.", "file": "templates/login.html", "title": "Login Page Template"}, {"code_snippet": "\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n  \u003chead\u003e\n    \u003cmeta charset=\"UTF-8\" /\u003e\n    \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /\u003e\n    \u003ctitle\u003eRegister - FastAPI Chat App\u003c/title\u003e\n    \u003clink\n      rel=\"icon\"\n      href=\"data:image/svg+xml,\u003csvg xmlns=\u0027http://www.w3.org/2000/svg\u0027 viewBox=\u00270 0 100 100\u0027\u003e\u003ctext y=\u0027.9em\u0027 font-size=\u002790\u0027\u003e\ud83d\udcac\u003c/text\u003e\u003c/svg\u003e\"\n    /\u003e\n    \u003clink rel=\"stylesheet\" href=\"/static/css/base.css\" /\u003e\n    \u003clink rel=\"stylesheet\" href=\"/static/css/app.css\" /\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n\u003cdiv class=\"auth-container\"\u003e\n  \u003cdiv class=\"auth-form\"\u003e\n    \u003ch2\u003eRegister\u003c/h2\u003e\n    \u003cdiv class=\"form-group\"\u003e\n      \u003clabel for=\"username\"\u003eUsername:\u003c/label\u003e\n      \u003cinput type=\"text\" id=\"username\" placeholder=\"Enter your username\" /\u003e\n    \u003c/div\u003e\n    \u003cdiv class=\"form-group\"\u003e\n      \u003clabel for=\"password\"\u003ePassword:\u003c/label\u003e\n      \u003cinput type=\"password\" id=\"password\" placeholder=\"Enter your password\" /\u003e\n    \u003c/div\u003e\n    \u003cdiv class=\"form-group\"\u003e\n      \u003clabel for=\"confirmPassword\"\u003eConfirm Password:\u003c/label\u003e\n      \u003cinput type=\"password\" id=\"confirmPassword\" placeholder=\"Confirm your password\" /\u003e\n    \u003c/div\u003e\n    \u003cbutton class=\"btn btn-primary\" onclick=\"register()\"\u003eRegister\u003c/button\u003e\n    \u003cp class=\"auth-link\"\u003eAlready have an account? \u003ca href=\"/login\"\u003eLogin\u003c/a\u003e\u003c/p\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n\n    \u003cscript src=\"/static/js/common.js\"\u003e\u003c/script\u003e\n\u003cscript src=\"/static/js/register.js\"\u003e\u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e", "description": "Now let\u0027s create our registration page template. This HTML template will provide a user-friendly interface for new user registration with proper form validation and styling. I\u0027ll show you how to structure the registration form with password confirmation, proper labeling, and integration with our JavaScript validation. This template will ensure a smooth user experience during the registration process.", "file": "templates/register.html", "title": "Registration Page Template"}, {"code_snippet": "\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n  \u003chead\u003e\n    \u003cmeta charset=\"UTF-8\" /\u003e\n    \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /\u003e\n    \u003ctitle\u003eChat - FastAPI Chat App\u003c/title\u003e\n    \u003clink\n      rel=\"icon\"\n      href=\"data:image/svg+xml,\u003csvg xmlns=\u0027http://www.w3.org/2000/svg\u0027 viewBox=\u00270 0 100 100\u0027\u003e\u003ctext y=\u0027.9em\u0027 font-size=\u002790\u0027\u003e\ud83d\udcac\u003c/text\u003e\u003c/svg\u003e\"\n    /\u003e\n    \u003clink rel=\"stylesheet\" href=\"/static/css/base.css\" /\u003e\n    \u003clink rel=\"stylesheet\" href=\"/static/css/app.css\" /\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cdiv class=\"chat-container\"\u003e\n      \u003cdiv class=\"chat-layout\"\u003e\n        \u003cdiv class=\"chat-area\"\u003e\n          \u003cdiv class=\"chat-messages\" id=\"messages\"\u003e\n            \u003c!-- Messages will be displayed here --\u003e\n          \u003c/div\u003e\n\n          \u003cdiv class=\"chat-input-container\"\u003e\n            \u003cform class=\"chat-input-form\" id=\"messageForm\"\u003e\n              \u003cinput\n                type=\"text\"\n                id=\"messageInput\"\n                class=\"chat-input\"\n                placeholder=\"Type your message...\"\n                autocomplete=\"off\"\n              /\u003e\n              \u003cbutton type=\"submit\" class=\"send-btn\"\u003e\u27a4\u003c/button\u003e\n            \u003c/form\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n\n        \u003cdiv class=\"sidebar\"\u003e\n          \u003cdiv class=\"sidebar-header\"\u003e\n            \u003cdiv class=\"user-info\"\u003e\n              \u003cdiv class=\"logged-in-as\"\u003e\n                Logged in as: \u003cspan id=\"current-username\"\u003eLoading...\u003c/span\u003e\n              \u003c/div\u003e\n              \u003cbutton class=\"logout-btn\" onclick=\"logout()\"\u003eLogout\u003c/button\u003e\n            \u003c/div\u003e\n            \u003ch3 class=\"online-users-label\"\u003eOnline Users\u003c/h3\u003e\n          \u003c/div\u003e\n          \u003cdiv id=\"online-users\" class=\"online-users\"\u003e\u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cscript src=\"/static/js/common.js\"\u003e\u003c/script\u003e\n    \u003cscript src=\"/static/js/chat.js\"\u003e\u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e", "description": "Now let\u0027s create our main chat interface HTML template. This template will provide the structure for our modern chat application with a beautiful layout that includes the chat area, message input, and sidebar for online users. I\u0027ll show you how to structure the HTML for optimal user experience, including proper semantic markup, accessibility considerations, and integration points for our CSS and JavaScript. This template will be rendered by our FastAPI application and will serve as the main interface for our chat functionality.", "file": "templates/chat.html", "title": "Chat Interface Template"}], "title": "HTML Templates"}, {"phase": 10, "steps": [{"code_snippet": "from fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom fastapi.staticfiles import StaticFiles\nfrom fastapi.responses import FileResponse\nfrom fastapi.templating import Jinja2Templates\nfrom app.routes import router\nfrom app.utils.config import settings\nfrom fastapi.requests import Request\nfrom app.database import init_db\n\napp = FastAPI(\n    title=settings.PROJECT_NAME,\n    version=settings.VERSION,\n    description=settings.DESCRIPTION,\n    openapi_url=f\"{settings.API_V1_STR}/openapi.json\"\n)\n\n# Set up CORS middleware\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=settings.parsed_allowed_hosts,\n    allow_credentials=True,  # Needed for JWT via cookies\n    allow_methods=[\"GET\", \"POST\"],  # Avoid using \"*\" if not needed\n    allow_headers=[\"Authorization\", \"Content-Type\", \"application/json\"], \n)\n\n# Initialize database\ninit_db()\n\n# Set up templates\ntemplates = Jinja2Templates(directory=\"templates\")\n\n# Mount static files\napp.mount(\"/static\", StaticFiles(directory=\"static\"), name=\"static\")\n\n# Include all routes\napp.include_router(router, prefix=settings.API_V1_STR)\n\n@app.get(\"/\")\nasync def root(request: Request):\n    return templates.TemplateResponse(\"login.html\", {\"request\": request})\n\n@app.get(\"/login\")\nasync def login_page(request: Request):\n    return templates.TemplateResponse(\"login.html\", {\"request\": request})\n\n@app.get(\"/register\")\nasync def register_page(request: Request):\n    return templates.TemplateResponse(\"register.html\", {\"request\": request})\n\n@app.get(\"/chat\")\nasync def chat_page(request: Request):\n    return templates.TemplateResponse(\"chat.html\", {\"request\": request})\n\n@app.get(\"/health\")\nasync def health_check():\n    return {\"status\": \"healthy\"}\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(app, host=\"0.0.0.0\", port=8000)", "description": "Finally, let\u0027s bring everything together in our main FastAPI application file. This is where we\u0027ll configure our FastAPI app, set up middleware, mount static files and templates, and include all our routes. I\u0027ll show you how to properly configure CORS for cross-origin requests, set up the database initialization, and create the main application structure. This file serves as the entry point for our entire chat application and ties together all the components we\u0027ve built throughout this tutorial.", "file": "main.py", "title": "Main Application Setup"}], "title": "Main Application"}], "prerequisites": ["Python 3.8+", "Basic knowledge of FastAPI, SQLAlchemy, and WebSockets"], "security_features": ["Password hashing with bcrypt and salt rounds", "JWT token authentication with secure headers", "CORS middleware protection", "Environment-based configuration", "Input validation with Pydantic schemas", "WebSocket authentication with token verification", "No hardcoded secrets in code", "Proper error handling and logging"], "title": "FastAPI Real-Time Chat Application - Complete Guide"};
      window.totalSteps = 21;

      // Make flow data available globally
      
      window.flowData = {"architecture": {"components": {"client": {"components": [{"description": "JWT token management and validation", "title": "Authentication"}, {"description": "Real-time connection management", "title": "WebSocket Client"}, {"description": "Chat interface and animations", "title": "UI Management"}, {"description": "Send/receive message processing", "title": "Message Handling"}], "title": "Client-Side (Browser)"}, "database": {"components": [{"description": "Stores user accounts and hashed passwords", "title": "User Table"}, {"description": "User authentication state", "title": "Session Management"}, {"description": "User registration and profile data", "title": "Data Persistence"}], "title": "Database (SQLite)"}, "server": {"components": [{"description": "Register, login, token validation", "title": "Authentication Routes"}, {"description": "Connection tracking and broadcasting", "title": "WebSocket Manager"}, {"description": "JWT verification and CORS", "title": "Security Middleware"}, {"description": "Message validation and routing", "title": "Message Processing"}], "title": "Server-Side (FastAPI)"}}, "title": "System Architecture"}, "description": "Arrow keys to focus step elements", "legend": {"items": [{"color": "legend-normal", "label": "Normal Step", "type": "normal"}, {"color": "legend-decision", "label": "Decision Point", "type": "decision"}, {"color": "legend-success", "label": "Success/Completion", "type": "success"}, {"color": "legend-database", "label": "Database Operation", "type": "database"}, {"color": "legend-security", "label": "Security Operation", "type": "security"}], "title": "Flow Legend"}, "metadata": {"locations": {"client": {"badge_class": "client", "color": "#48bb78", "description": "Client-side (browser) operation"}, "database": {"badge_class": "database", "color": "#a0aec0", "description": "Database operation"}, "server": {"badge_class": "server", "color": "#4facfe", "description": "Server-side (FastAPI) operation"}}, "step_types": {"database": {"css_class": "database-point", "description": "Database operation or query"}, "decision": {"css_class": "decision-point", "description": "Decision point with branching logic"}, "normal": {"css_class": "", "description": "Standard flow step"}, "security": {"css_class": "security-point", "description": "Security-related operation"}, "success": {"css_class": "success-point", "description": "Successful completion of a process"}}}, "phases": [{"flow_title": "1. User Registration Process", "phase": 1, "steps": [{"description": "User navigates to /register endpoint", "location": {"file": "main.py \u2192 register_page()", "type": "server"}, "step": 1, "step_type": "normal", "title": "User Visits Registration Page"}, {"description": "Username and password input", "location": {"file": "register.html template", "type": "client"}, "step": 2, "step_type": "normal", "title": "User Fills Registration Form"}, {"description": "Client-side validation (required fields, password 4+ chars)", "location": {"file": "static/js/register.js \u2192 register()", "type": "client"}, "step": 3, "step_type": "normal", "title": "JavaScript Validates Form"}, {"description": "POST /api/v1/auth/register with user data", "location": {"file": "static/js/register.js \u2192 fetch()", "type": "client"}, "step": 4, "step_type": "normal", "title": "Send Registration Request"}, {"description": "Query database for existing username", "location": {"file": "app/routes.py \u2192 get_user_by_username()", "type": "server"}, "step": 5, "step_type": "database", "title": "Check Username Availability"}, {"description": "Check if username already exists", "location": {"file": "app/routes.py \u2192 validation logic", "type": "server"}, "step": 6, "step_type": "decision", "title": "Username Available?"}, {"description": "Convert plain password to secure hash", "location": {"file": "app/auth.py \u2192 get_password_hash()", "type": "server"}, "step": 7, "step_type": "security", "title": "Hash Password with bcrypt"}, {"description": "Insert new user record with hashed password", "location": {"file": "app/database.py \u2192 create_user()", "type": "server"}, "step": 8, "step_type": "database", "title": "Save User to Database"}, {"description": "Return user data (without password)", "location": {"file": "app/routes.py \u2192 register() \u2192 response", "type": "server"}, "step": 9, "step_type": "success", "title": "Registration Successful"}, {"description": "User can now login with new credentials", "location": {"file": "static/js/register.js \u2192 redirectTo(\u0027/login\u0027)", "type": "client"}, "step": 10, "step_type": "normal", "title": "Redirect to Login Page"}], "title": "User Registration"}, {"flow_title": "2. User Login \u0026 JWT Token Generation", "phase": 2, "steps": [{"description": "User navigates to /login endpoint", "location": {"file": "main.py \u2192 login_page()", "type": "server"}, "step": 1, "step_type": "normal", "title": "User Visits Login Page"}, {"description": "Username and password input", "location": {"file": "login.html template", "type": "client"}, "step": 2, "step_type": "normal", "title": "User Enters Credentials"}, {"description": "POST /api/v1/auth/login with form data", "location": {"file": "static/js/login.js \u2192 login()", "type": "client"}, "step": 3, "step_type": "normal", "title": "Send Login Request"}, {"description": "Find user by username", "location": {"file": "app/routes.py \u2192 get_user_by_username()", "type": "server"}, "step": 4, "step_type": "database", "title": "Query Database for User"}, {"description": "Check if username is found", "location": {"file": "app/routes.py \u2192 validation logic", "type": "server"}, "step": 5, "step_type": "decision", "title": "User Exists?"}, {"description": "Compare input password with stored hash", "location": {"file": "app/auth.py \u2192 verify_password()", "type": "server"}, "step": 6, "step_type": "security", "title": "Verify Password Hash"}, {"description": "bcrypt verification result", "location": {"file": "app/routes.py \u2192 validation logic", "type": "server"}, "step": 7, "step_type": "decision", "title": "Password Correct?"}, {"description": "Create access token with user ID and expiration", "location": {"file": "app/auth.py \u2192 create_access_token()", "type": "server"}, "step": 8, "step_type": "security", "title": "Generate JWT Token"}, {"description": "Send token to client", "location": {"file": "app/routes.py \u2192 login() \u2192 response", "type": "server"}, "step": 9, "step_type": "success", "title": "Return JWT Token"}, {"description": "Client saves token for future requests", "location": {"file": "static/js/login.js \u2192 setToken()", "type": "client"}, "step": 10, "step_type": "normal", "title": "Store Token in localStorage"}, {"description": "User is now authenticated and ready to chat", "location": {"file": "static/js/login.js \u2192 redirectTo(\u0027/chat\u0027)", "type": "client"}, "step": 11, "step_type": "normal", "title": "Redirect to Chat Page"}], "title": "User Authentication"}, {"flow_title": "3. Chat Page Initialization", "phase": 3, "steps": [{"description": "Navigate to /chat endpoint", "location": {"file": "main.py \u2192 chat_page()", "type": "server"}, "step": 1, "step_type": "normal", "title": "User Visits Chat Page"}, {"description": "Verify JWT token exists in localStorage", "location": {"file": "static/js/chat.js \u2192 initializeChat()", "type": "client"}, "step": 2, "step_type": "normal", "title": "JavaScript Checks Authentication"}, {"description": "Check if user is logged in", "location": {"file": "static/js/common.js \u2192 isAuthenticated()", "type": "client"}, "step": 3, "step_type": "decision", "title": "Token Exists?"}, {"description": "GET /api/v1/auth/me with JWT token", "location": {"file": "static/js/chat.js \u2192 apiRequest(\u0027/auth/me\u0027)", "type": "client"}, "step": 4, "step_type": "normal", "title": "Get Current User Info"}, {"description": "Decode and verify token signature", "location": {"file": "app/auth.py \u2192 verify_token()", "type": "server"}, "step": 5, "step_type": "security", "title": "Server Validates JWT Token"}, {"description": "Get user details by ID from token", "location": {"file": "app/database.py \u2192 get_user()", "type": "server"}, "step": 6, "step_type": "database", "title": "Fetch User from Database"}, {"description": "Display username in sidebar", "location": {"file": "static/js/chat.js \u2192 update username display", "type": "client"}, "step": 7, "step_type": "normal", "title": "Update UI with User Info"}, {"description": "Ready to establish real-time connection", "location": {"file": "static/js/chat.js \u2192 connectWebSocket()", "type": "client"}, "step": 8, "step_type": "success", "title": "Initialize WebSocket Connection"}], "title": "Chat Initialization"}, {"flow_title": "4. WebSocket Connection \u0026 Chat", "phase": 4, "steps": [{"description": "ws://localhost:8000/api/v1/chat/ws/{token}", "location": {"file": "static/js/chat.js \u2192 new WebSocket()", "type": "client"}, "step": 1, "step_type": "normal", "title": "Create WebSocket Connection"}, {"description": "WebSocket handshake completed", "location": {"file": "app/routes.py \u2192 websocket_endpoint()", "type": "server"}, "step": 2, "step_type": "normal", "title": "Server Accepts Connection"}, {"description": "Verify JWT token from URL", "location": {"file": "app/auth.py \u2192 verify_token()", "type": "server"}, "step": 3, "step_type": "security", "title": "Server Validates Token"}, {"description": "Check authentication status", "location": {"file": "app/routes.py \u2192 websocket_endpoint() \u2192 validation", "type": "server"}, "step": 4, "step_type": "decision", "title": "Token Valid?"}, {"description": "Store WebSocket connection", "location": {"file": "app/utils/websocket_manager.py \u2192 connect()", "type": "server"}, "step": 5, "step_type": "normal", "title": "Add User to Connection Manager"}, {"description": "Notify all users about new connection", "location": {"file": "app/utils/websocket_manager.py \u2192 broadcast_message()", "type": "server"}, "step": 6, "step_type": "normal", "title": "Broadcast User Joined Animation"}, {"description": "Get current online users", "location": {"file": "static/js/chat.js \u2192 loadOnlineUsers()", "type": "client"}, "step": 7, "step_type": "normal", "title": "Request Online Users List"}, {"description": "Ready for real-time messaging", "location": {"file": "static/js/chat.js \u2192 ws.onopen", "type": "client"}, "step": 8, "step_type": "success", "title": "Connection Established \u2713"}], "title": "Real-Time Chat"}, {"flow_title": "5. Real-Time Message Flow", "phase": 5, "steps": [{"description": "Input text in chat interface", "location": {"file": "chat.html \u2192 message input field", "type": "client"}, "step": 1, "step_type": "normal", "title": "User Types Message"}, {"description": "Click send or press Enter", "location": {"file": "static/js/chat.js \u2192 message form submit", "type": "client"}, "step": 2, "step_type": "normal", "title": "User Sends Message"}, {"description": "Format with type, content, timestamp", "location": {"file": "static/js/chat.js \u2192 create message JSON", "type": "client"}, "step": 3, "step_type": "normal", "title": "Create Message Object"}, {"description": "Transmit message to server", "location": {"file": "static/js/chat.js \u2192 ws.send()", "type": "client"}, "step": 4, "step_type": "normal", "title": "Send via WebSocket"}, {"description": "Validate and format message", "location": {"file": "app/utils/websocket_manager.py \u2192 handle_websocket_message()", "type": "server"}, "step": 5, "step_type": "normal", "title": "Server Processes Message"}, {"description": "Send message to all connected clients", "location": {"file": "app/utils/websocket_manager.py \u2192 broadcast_message()", "type": "server"}, "step": 6, "step_type": "normal", "title": "Broadcast to All Users"}, {"description": "WebSocket message event triggered", "location": {"file": "static/js/chat.js \u2192 ws.onmessage", "type": "client"}, "step": 7, "step_type": "normal", "title": "Each Client Receives Message"}, {"description": "Parse and determine message type", "location": {"file": "static/js/chat.js \u2192 handleWebSocketMessage()", "type": "client"}, "step": 8, "step_type": "normal", "title": "JavaScript Processes Message"}, {"description": "Add message to chat interface", "location": {"file": "static/js/chat.js \u2192 addMessage()", "type": "client"}, "step": 9, "step_type": "success", "title": "Display Message in Chat"}], "title": "Message Flow"}], "title": "Complete FastAPI Chat App Flow"};
      
    </script>

    <!-- Flow Diagram Script -->

    <script src='/static/js/scripts.js' defer></script>
  </body>
</html>